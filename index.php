<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- CSRF Token -->
  <meta name="csrf-token" content="YoIkc4bBr4HMTVCE0mT8tUfvbcyfI0xzAbtWc7DT">
  <title>FRM Dashboard</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Scripts -->
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Scripts -->
  <script src="scripts/jquery-3.3.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <!-- Font Awesome -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <link href="css/css2.css" rel="stylesheet">


  <link rel="stylesheet" href="css/jquery.dataTables.min.css">
  <!-- Jquery Toast -->
  <link href="css/jquery.toast.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="css/all.min.css">
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="https://doaf.punjab.gov.pk/assets/images/favicon.svg">
  <link rel="stylesheet" href="css/style1.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="css/OverlayScrollbars.min.css">

  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="css/tough.css" />
  <link rel="stylesheet" type="text/css" href="css/rough.css" />

  <!-- Jquery Toast -->
  <link href="css/jquery.toast.min.css" rel="stylesheet" />
  <!-- Date Range Picker -->
  <link rel="stylesheet" type="text/css" href="css/daterangepicker.css" />
  <!-- jquery -->
  <script src="scripts/jquery-1.12.4.min.js"></script>
  <!-- Custom Loader -->
  <!-- <link href="css/loader-style.css" rel="stylesheet" /> -->

  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="css/boxicons.css" />
  <!-- Sliding tabs -->
  <link rel="stylesheet" href="css/jquery.bs4-scrolling-tabs.css">
  <link rel="stylesheet" href="css/jquery.bs4-scrolling-tabs.css">

  <!-- turf -->
  <script src="scripts/turf.min.js"></script>
  <link rel="stylesheet" href="leaflet/leaflet.css" type="text/css">

  <!-- <link rel="stylesheet" href="leaflet" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" type="text/css"/> -->
  <script src="leaflet/leaflet.js" crossorigin=""></script>

  <!-- pdf JS -->
  <script src="scripts/jspdf.umd.min.js"></script>
  <!-- pdf autotable JS -->
  <script src="scripts/jspdf.plugin.autotable.js"></script>
  <!-- leaflet-omnivore  JS -->
  <script src="https://unpkg.com/leaflet-omnivore@0.3.0/leaflet-omnivore.min.js"></script>
  <!-- jquery.ui.touch-punch.min -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.2/jquery.ui.touch-punch.min.js"></script>
  <link href="css/jquery-ui.css" rel="stylesheet" type="text/css" />
  <!-- jquery.ui -->
  <script src="scripts/jquery-ui.js"></script>
  <script
    src="https://cdn.jsdelivr.net/gh/carlosign/LeafletSlider-LocalTimeV2@main/dist/leaflet.LocalTimeV2.min.js"></script>

  <!-- Leaflet Measure Plugin JS -->
  <script src="scripts/leaflet-image.js"></script>
  <script src="scripts/leaflet-measure.js"></script>
  <script src="scripts/leaflet.markercluster.js"></script>
  <script src="scripts/leaflet-heat.js"></script>
  <script src="scripts/leaflet-simple-map-screenshoter.js"></script>
  <script src="scripts/FileSaver.js"></script>


  <!-- jquery JS -->
  <script src="scripts/jquery.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="scripts/bootstrap.min.js"></script>
  <!-- bootstrap bundle JS -->
  <script src="scripts/bootstrap.bundle.min.js"></script>
  <!-- leaflet JS -->
  <script src="scripts/leaflet-loader.js"></script>
  <!-- confirm box -->
  <script src="scripts/bootstrap-confirm.min.js"></script>
  <!-- overlayScrollbars -->
  <script src="scripts/jquery.overlayScrollbars.min.js"></script>
  <!-- app JS -->
  <script src="scripts/app.js"></script>
  <!-- JQUERY Data tables JS -->
  <script src="scripts/jquery.dataTables.min.js"></script>
  <!-- Jquery Toast JS -->
  <script src="scripts/jquery.toast.min.js"></script>
  <!-- Custom Functions JS -->
  <script src="scripts/helpers.js"></script>
  <!-- moment JS -->
  <script src="scripts/moment.min.js"></script>
  <!-- daterangepicker.moment JS -->
  <script type="text/javascript" src="scripts/moment.min.js"></script>
  <!--daterangepicker.min-->
  <script type="text/javascript" src="scripts/daterangepicker.min.js"></script>
  <!--dataTables.buttons.min.js-->
  <script type="text/javascript" src="scripts/dataTables.buttons.min.js"></script>
  <!--buttons html5 js-->
  <script type="text/javascript" src="scripts/buttons.html5.min.js"></script>
  <!--buttons print js-->
  <script type="text/javascript" src="scripts/buttons.print.min.js"></script>
  <!--buttons colVis js-->
  <script type="text/javascript" src="scripts/buttons.colVis.min.js"></script>
  <!--jz zip js-->
  <script type="text/javascript" src="scripts/jszip.min.js"></script>
  <!--pdf make js-->
  <script type="text/javascript" src="scripts/pdfmake.min.js"></script>
  <!--vfs fonts-->
  <script type="text/javascript" src="scripts/vfs_fonts.js"></script>
  <!-- Sliding tabs -->
  <script type="text/javascript" src="scripts/jquery.bs4-scrolling-tabs.js"></script>
  <!-- highcharts -->
  <script src="scripts/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>

  <!-- dynamic table -->
  <script src="scripts/dynamic_table.js"></script>
  <!-- jquery ui -->
  <script src="scripts/jquery-ui.min.js"></script>
  <!-- filters -->
  <script src="scripts/filters.js"></script>

  <link rel="stylesheet" href="css/leaflet-measure.css">
  <link rel="stylesheet" href="css/MarkerCluster.css">
  <link rel="stylesheet" href="css/MarkerCluster.Default.css">

  <link rel="stylesheet" type="text/css" href="css/leaflet-loader.css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" />


  <script type="text/javascript"
    class="flasher-js">(function () { var rootScript = 'https://cdn.jsdelivr.net/npm/@flasher/flasher@1.3.2/dist/flasher.min.js'; var FLASHER_FLASH_BAG_PLACE_HOLDER = {}; var options = mergeOptions([], FLASHER_FLASH_BAG_PLACE_HOLDER); function mergeOptions(first, second) { return { context: merge(first.context || {}, second.context || {}), envelopes: merge(first.envelopes || [], second.envelopes || []), options: merge(first.options || {}, second.options || {}), scripts: merge(first.scripts || [], second.scripts || []), styles: merge(first.styles || [], second.styles || []), }; } function merge(first, second) { if (Array.isArray(first) && Array.isArray(second)) { return first.concat(second).filter(function (item, index, array) { return array.indexOf(item) === index; }); } return Object.assign({}, first, second); } function renderOptions(options) { if (!window.hasOwnProperty('flasher')) { console.error('Flasher is not loaded'); return; } requestAnimationFrame(function () { window.flasher.render(options); }); } function render(options) { if ('loading' !== document.readyState) { renderOptions(options); return; } document.addEventListener('DOMContentLoaded', function () { renderOptions(options); }); } if (1 === document.querySelectorAll('script.flasher-js').length) { document.addEventListener('flasher:render', function (event) { render(event.detail); }); } if (window.hasOwnProperty('flasher') || !rootScript || document.querySelector('script[src="' + rootScript + '"]')) { render(options); } else { var tag = document.createElement('script'); tag.setAttribute('src', rootScript); tag.setAttribute('type', 'text/javascript'); tag.onload = function () { render(options); }; document.head.appendChild(tag); } })();</script>


</head>


<script>
  // Static table functions 
  function openNewPage(zone) {
    // Get the selected year and month from the dropdowns
    const year = document.getElementById('yearFilter').value;
    const month = document.getElementById('monthFilter').value;

    // Redirect to the new page with zone, year, and month as query parameters
    window.location.href = "reports/Dynamictable.php?zone=" + encodeURIComponent(zone) +
      "&year=" + encodeURIComponent(year) +
      "&month=" + encodeURIComponent(month);
  }


  function showLoad() {
    const loader = document.getElementById('global-loader');
    if (loader) {
      document.body.style.overflow = 'hidden';
      loader.style.display = 'flex';
    }
  }

  function hideLoad() {
    const loader = document.getElementById('global-loader');
    if (loader) {
      loader.style.display = 'none';
      document.body.style.overflow = '';
    }
  }

  $(document).ready(function () {
    // Initial load - fetch data for default year
    showLoad();
    fetchInitialData();

    // Handle year filter change - update all sections
    $('#yearFilter').on('change', function () {
      showLoad();
      fetchYearData();
    });

    // Handle month filter change - update only statistics cards
    $('#monthFilter').on('change', function () {
      showLoad();
      fetchMonthData();
    });
  });

  // Initial data load
  function fetchInitialData() {
    const initialYear = $('#yearFilter').val();
    fetchYearData(initialYear);
  }

  // Fetch data when year changes (updates all sections)
  function fetchYearData() {
    const selectedYear = $('#yearFilter').val();

    var phpUrl = "fire backend/getincidentsStats.php";
    var requestData = {
      year: selectedYear,
      month: null // Always get full year data for these sections
    };

    $.ajax({
      url: phpUrl,
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify(requestData),
      success: function (data) {
        if (data.error) {
          console.error(data.error);
          hideLoad();
          return;
        }

        // Update all sections
        updateDashboard(data); // Cards (will use current month filter)
        updateYearSections(data); // Other sections
        hideLoad();
      },
      error: function (jqXHR, textStatus, errorThrown) {
        console.error("Error fetching year data:", textStatus, errorThrown);
        hideLoad();
      }
    });
  }

  // Fetch data when month changes (updates only cards)
  function fetchMonthData() {
    const selectedYear = $('#yearFilter').val();
    const selectedMonth = $('#monthFilter').val() ? parseInt($('#monthFilter').val()) : null;

    var phpUrl = "fire backend/getincidentsStats.php";
    var requestData = {
      year: selectedYear,
      month: selectedMonth
    };

    $.ajax({
      url: phpUrl,
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify(requestData),
      success: function (data) {
        if (data.error) {
          console.error(data.error);
          hideLoad();
          return;
        }

        // Update only the cards
        updateDashboard(data);
        hideLoad();
      },
      error: function (jqXHR, textStatus, errorThrown) {
        console.error("Error fetching month data:", textStatus, errorThrown);
        hideLoad();
      }
    });
  }

  function updateDashboard(data) {
    try {
      // Validate data structure
      if (!data || !data.incident_summary || !Array.isArray(data.incident_summary)) {
        throw new Error("Invalid data structure received");
      }

      // Animate plain numbers
      function animateNumber(id, endValue, suffixHtml = '', duration = 1000) {
        const element = document.getElementById(id);
        if (!element) return;
        let startValue = parseInt(element.textContent) || 0; // Get current value for smoother animation
        const startTime = performance.now();
        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const value = Math.floor(startValue + progress * (endValue - startValue));
          element.innerHTML = `${value}${suffixHtml}`;
          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.innerHTML = `${endValue}${suffixHtml}`;
          }
        }
        requestAnimationFrame(update);
      }
      // Animate formatted numbers (for Effected Area)
      function animateFormattedNumber(id, endValue, formatFunc, suffixHtml = '', duration = 1000) {
        const element = document.getElementById(id);
        if (!element) return;
        let startValue = parseFloat(element.textContent.replace(/[^0-9.]/g, '')) || 0; // Extract current numeric value
        const startTime = performance.now();
        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const value = startValue + progress * (endValue - startValue);
          element.innerHTML = `${formatFunc(value)}${suffixHtml}`;
          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            element.innerHTML = `${formatFunc(endValue)}${suffixHtml}`;
          }
        }
        requestAnimationFrame(update);
      }
      // Format function
      function formatAffectedArea(area) {
        if (area >= 1000) {
          return (area / 1000).toFixed(1) + " K";
        }
        return area.toFixed(0);
      }
      // Now update all 6 cards
      // Northern Zone
      const northernData = data.incident_summary.find(item =>
        item.forest_zone && item.forest_zone.includes('Northern')
      ) || { fire_incident_count: 0, total_affected_area: 0 };
      animateNumber('NorthernZoneIncidents', northernData.fire_incident_count, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);
      animateFormattedNumber('NorthernZoneEffected', northernData.total_affected_area, formatAffectedArea, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);
      // Central Zone
      const centralData = data.incident_summary.find(item =>
        item.forest_zone && item.forest_zone.includes('Central')
      ) || { fire_incident_count: 0, total_affected_area: 0 };
      animateNumber('CentralZoneIncidents', centralData.fire_incident_count, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);
      animateFormattedNumber('CentralZoneEffected', centralData.total_affected_area, formatAffectedArea, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);
      // Southern Zone
      const southernData = data.incident_summary.find(item =>
        item.forest_zone && item.forest_zone.includes('Southern')
      ) || { fire_incident_count: 0, total_affected_area: 0 };
      animateNumber('SouthernZoneIncidents', southernData.fire_incident_count, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);
      animateFormattedNumber('SouthernZoneEffected', southernData.total_affected_area, formatAffectedArea, ` <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" width="50">`);

      // Calculate the total number of incidents
      const totalIncidents = northernData.fire_incident_count + centralData.fire_incident_count + southernData.fire_incident_count;

      // Update the total incidents card
      const totalIncidentsElementId = 'totalFireIncidentsCardValue';
      const totalIncidentsElement = document.getElementById(totalIncidentsElementId);
      if (totalIncidentsElement) {
        animateNumber(totalIncidentsElementId, totalIncidents);
      }

    } catch (error) {
      console.error("Error updating dashboard:", error);
      // Set default values when error occurs
      $('[id$="Incidents"], [id$="Effected"]').html("0 <img src='https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png' width='50'>");
    }
  }
  // Update the other sections (division table, monthly graph, yearly trend)
  function updateYearSections(data) {
    // Update monthly graph
    if (data.fire_count_monthwise_summary) {
      createActivityChart(data.fire_count_monthwise_summary);
    }

    // Update trend line
    if (data.fire_count_yearwise_summary) {
      createDynamicActivityTrend(changeData(data));
    }

    // Update division table
    if (data.fire_count_divisionwise_summary) {
      populateIncidentsTable(data.fire_count_divisionwise_summary);
    }
  }

  //Function for change trend line data.

  function changeData(rawData) {
    const zoneData = {};

    // Iterate through the summary data
    rawData.fire_count_yearwise_summary.forEach((item) => {
      const zone = item.zone.replace(/\"/g, ""); // Remove any extra quotes
      const year = item.year;
      const count = item.count;

      // Initialize the zone if it doesn't exist
      if (!zoneData[zone]) {
        zoneData[zone] = {
          name: zone,
          data: [],
        };
      }

      const yearIndex = year - 2019; // Adjust index based on the starting year

      while (zoneData[zone].data.length <= yearIndex) {
        zoneData[zone].data.push(0); // Fill with 0s for missing years
      }

      // Set the count for the specific year
      zoneData[zone].data[yearIndex] = count;
    });

    // Convert the object to an array and log the result
    const result = Object.values(zoneData);
    // console.log(result);
    return result; // Return the result if needed
  };


  //Function for division wise table data 

  function populateIncidentsTable(incidentsData) {
    try {
      // 1. Validate input data
      if (!incidentsData || !Array.isArray(incidentsData)) {
        console.warn("Invalid or empty incidents data received");
        incidentsData = []; // Set to empty array as fallback
      }

      // 2. Get table body element safely
      const tableBody = document.getElementById("tableBodyIncidents");
      if (!tableBody) {
        console.error("Table body element not found");
        return;
      }

      // 3. Clear existing rows
      tableBody.innerHTML = "";

      // 4. Handle empty data case
      if (incidentsData.length === 0) {
        const row = document.createElement("tr");
        row.innerHTML = `
                <td colspan="3" class="text-center">No incident data available</td>
            `;
        tableBody.appendChild(row);
        return;
      }

      // 5. Populate table with data
      incidentsData.forEach((data, index) => {
        // Validate each row's data structure
        const divisionName = data.division_name || "Unknown Division";
        const incidentCount = data.fire_incident_count || 0;

        const row = document.createElement("tr");
        row.innerHTML = `
                <td>${index + 1}</td>
                <td>${divisionName}</td>
                <td>${incidentCount}</td>
            `;
        tableBody.appendChild(row);
      });

    } catch (error) {
      console.error("Error populating incidents table:", error);
      // Optionally show error message in table
      const tableBody = document.getElementById("tableBodyIncidents");
      if (tableBody) {
        tableBody.innerHTML = `
                <tr>
                    <td colspan="3" class="text-center text-danger">
                        Error loading data
                    </td>
                </tr>
            `;
      }
    }
  }

</script>

<div class="loader-container" id="global-loader">
  <div class="cube-loader">
    <div class="cube"></div>
    <div class="cube"></div>
    <div class="cube"></div>
    <div class="cube"></div>
  </div>
</div>


<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">
    <!-- <div class="dashboard-heading"> -->
    <!-- <h2 class="text-center" style="font-family: 'Raleway', sans-serif; font-size: 34px; color: #388E3C;">
        <span
          style="background: linear-gradient(to right, #FF9800, #F44336); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Forest
          Fire</span> Reporting & Monitoring Dashboard
      </h2> -->
    <!-- </div> -->
    <nav
  class="main-header navbar navbar-expand navbar-white navbar-light d-flex align-items-center justify-content-between"
  style="background-color: #f4f6f9; border-radius: 0; width: 78vw; position: absolute; height: 45px; top: 0; left: 0; z-index: 1030;">

  <ul class="navbar-nav align-items-center">
    <li class="nav-item pe-2">
      <a class="nav-link" data-widget="pushmenu" href="#" role="button">
        <i class="fas fa-bars fs-4"></i>
      </a>
    </li>
  </ul>

  <h2 class="text-center m-0"
    style="font-family: 'Raleway', sans-serif; color: #388E3C; text-align: center; white-space: nowrap;">
    <span style="background: linear-gradient(to right, #FF9800, #F44336); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
      Forest Fire Reporting & Monitoring Dashboard
    </span>
  </h2>

  <ul class="navbar-nav ml-auto">
    <li class="nav-item" style="width: 40px;"></li>
</ul>

</nav>

    <style>

      .command.disabled {
        pointer-events: none;
        /* disables all interaction */
        opacity: 0.5;
        /* makes it look visually disabled */
      }

      /* Default styles for larger screens (already in your inline styles) */
      .main-header h2 {
        font-size: 24px;
        /* Or your preferred larger size */
      }

      /* Media query for smaller screens (e.g., tablets and phones) */
      @media (max-width: 768px) {
        .main-header h2 {
          font-size: 18px;
          /* Smaller font size for mobile */
        }

        /* Optionally, you can hide the longer text and show a shorter version */
        .main-header h2 .d-none {
          display: inline;
          /* Show the "Reporting & Monitoring Dashboard" text */
        }

        .main-header h2 .d-sm-inline {
          display: none;
          /* Hide it on smaller screens */
        }
      }

      /* Further adjustments for even smaller screens (phones) */
      @media (max-width: 576px) {
        .main-header h2 {
          font-size: 16px;
          /* Even smaller for very narrow screens */
        }

        .main-header h2 span:first-child {
          /* Target "Forest Fire" */
          /* You could further reduce its size or even hide it */
          font-size: 14px;
        }
      }
    </style>
    <aside class="main-sidebar sidebar-dark-primary">

      <a href="" class="brand-link d-block text-decoration-none text-center">
        <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c64e473-logo_12.png" class="img-fluid me-1 mb-3 brand-image" alt="Dashboard Logo">
        <span
          class="brand-text text-black d-flex align-items-center flex-row flex-wrap ps-2 text-wrap justify-content-center">
          <span class="brand-text1 text-uppercase">Fire Monitoring <br>
            <span class="brand-text2">Dashboard</span></span>
        </span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar InspectionSideBar">
        <!-- Sidebar Menu -->
        <nav class="mt-4 pb-5 px-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <li class="nav-item mb-2 active">
              <a href="" class="nav-link rounded-0 py-2 d-inline-flex align-items-center mb-0">
                <svg width="28" class="img-fluid" height="28" viewBox="0 0 28 28" fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M9.84219 0.973267H3.78429C3.03886 0.97404 2.32419 1.27057 1.79718 1.79777C1.27017 2.32496 0.973881 3.03973 0.973366 3.78517V9.84112C0.973881 10.5866 1.27017 11.3013 1.79718 11.8285C2.32419 12.3557 3.03886 12.6522 3.78429 12.653H9.84219C10.5876 12.6522 11.3023 12.3557 11.8293 11.8285C12.3563 11.3013 12.6526 10.5866 12.6531 9.84112V3.78517C12.6526 3.03973 12.3563 2.32496 11.8293 1.79777C11.3023 1.27057 10.5876 0.97404 9.84219 0.973267V0.973267ZM10.7065 9.84112C10.7065 10.0704 10.6155 10.2904 10.4534 10.4526C10.2913 10.6149 10.0715 10.7061 9.84219 10.7064H3.78429C3.55498 10.7061 3.33514 10.6149 3.17308 10.4526C3.01102 10.2904 2.91999 10.0704 2.91999 9.84112V3.78517C2.91999 3.55585 3.01102 3.33591 3.17308 3.17367C3.33514 3.01143 3.55498 2.92015 3.78429 2.91989H9.84219C10.0715 2.92015 10.2913 3.01143 10.4534 3.17367C10.6155 3.33591 10.7065 3.55585 10.7065 3.78517V9.84112Z"
                    fill="#D9D9D9" />
                  <path
                    d="M23.4686 0.973267H17.4107C16.6652 0.97404 15.9506 1.27057 15.4235 1.79777C14.8965 2.32496 14.6002 3.03973 14.5997 3.78517V9.84112C14.6002 10.5866 14.8965 11.3013 15.4235 11.8285C15.9506 12.3557 16.6652 12.6522 17.4107 12.653H23.4686C24.214 12.6522 24.9287 12.3557 25.4557 11.8285C25.9827 11.3013 26.279 10.5866 26.2795 9.84112V3.78517C26.279 3.03973 25.9827 2.32496 25.4557 1.79777C24.9287 1.27057 24.214 0.97404 23.4686 0.973267V0.973267ZM24.3329 9.84112C24.3329 10.0704 24.2418 10.2904 24.0798 10.4526C23.9177 10.6149 23.6979 10.7061 23.4686 10.7064H17.4107C17.1813 10.7061 16.9615 10.6149 16.7994 10.4526C16.6374 10.2904 16.5464 10.0704 16.5464 9.84112V3.78517C16.5464 3.55585 16.6374 3.33591 16.7994 3.17367C16.9615 3.01143 17.1813 2.92015 17.4107 2.91989H23.4686C23.6979 2.92015 23.9177 3.01143 24.0798 3.17367C24.2418 3.33591 24.3329 3.55585 24.3329 3.78517V9.84112Z"
                    fill="#D9D9D9" />
                  <path
                    d="M23.4686 14.5997H17.4107C16.6652 14.6004 15.9506 14.897 15.4235 15.4242C14.8965 15.9514 14.6002 16.6661 14.5997 17.4116V23.4675C14.6002 24.213 14.8965 24.9277 15.4235 25.4549C15.9506 25.9821 16.6652 26.2786 17.4107 26.2794H23.4686C24.214 26.2786 24.9287 25.9821 25.4557 25.4549C25.9827 24.9277 26.279 24.213 26.2795 23.4675V17.4116C26.279 16.6661 25.9827 15.9514 25.4557 15.4242C24.9287 14.897 24.214 14.6004 23.4686 14.5997V14.5997ZM24.3329 23.4675C24.3329 23.6968 24.2418 23.9168 24.0798 24.079C23.9177 24.2413 23.6979 24.3325 23.4686 24.3328H17.4107C17.1813 24.3325 16.9615 24.2413 16.7994 24.079C16.6374 23.9168 16.5464 23.6968 16.5464 23.4675V17.4116C16.5464 17.1823 16.6374 16.9623 16.7994 16.8001C16.9615 16.6378 17.1813 16.5466 17.4107 16.5463H23.4686C23.6979 16.5466 23.9177 16.6378 24.0798 16.8001C24.2418 16.9623 24.3329 17.1823 24.3329 17.4116V23.4675Z"
                    fill="#D9D9D9" />
                  <path
                    d="M9.84219 14.5997H3.78429C3.03886 14.6004 2.32419 14.897 1.79718 15.4242C1.27017 15.9514 0.973881 16.6661 0.973366 17.4116V23.4675C0.973881 24.213 1.27017 24.9277 1.79718 25.4549C2.32419 25.9821 3.03886 26.2786 3.78429 26.2794H9.84219C10.5876 26.2786 11.3023 25.9821 11.8293 25.4549C12.3563 24.9277 12.6526 24.213 12.6531 23.4675V17.4116C12.6526 16.6661 12.3563 15.9514 11.8293 15.4242C11.3023 14.897 10.5876 14.6004 9.84219 14.5997V14.5997ZM10.7065 23.4675C10.7065 23.6968 10.6155 23.9168 10.4534 24.079C10.2913 24.2413 10.0715 24.3325 9.84219 24.3328H3.78429C3.55498 24.3325 3.33514 24.2413 3.17308 24.079C3.01102 23.9168 2.91999 23.6968 2.91999 23.4675V17.4116C2.91999 17.1823 3.01102 16.9623 3.17308 16.8001C3.33514 16.6378 3.55498 16.5466 3.78429 16.5463H9.84219C10.0715 16.5466 10.2913 16.6378 10.4534 16.8001C10.6155 16.9623 10.7065 17.1823 10.7065 17.4116V23.4675Z"
                    fill="#D9D9D9" />
                </svg>
                <p class="ms-2 navItemsName">
                  Dashboard
                </p>
              </a>
            </li>
            <!-- Master Data Start -->
            <li class="nav-item mb-2 ">
    <div class="nav-link rounded-0 py-2">
        <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                fill="#D9D9D9" />
            <path
                d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                fill="#D9D9D9" />
        </svg>
        <p class="ms-2 navItemsName" style="color: white; font-weight: bold;">
            Zones
        </p>
    </div>
</li>
<li class="nav-item mb-2 ">
    <div class="nav-link rounded-0 py-2">
        <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                fill="#D9D9D9" />
            <path
                d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                fill="#D9D9D9" />
        </svg>
        <p class="ms-2 navItemsName">
            Circles
        </p>
    </div>
</li>
<li class="nav-item mb-2 ">
    <div class="nav-link rounded-0 py-2">
        <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                fill="#D9D9D9" />
            <path
                d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                fill="#D9D9D9" />
        </svg>
        <p class="ms-2 navItemsName">
            Divisions
        </p>
    </div>
</li>
<li class="nav-item mb-2 ">
    <div class="nav-link rounded-0 py-2">
        <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                fill="#D9D9D9" />
            <path
                d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                fill="#D9D9D9" />
        </svg>
        <p class="ms-2 navItemsName">
            Sub-Divisions
        </p>
    </div>
</li>
<li class="nav-item mb-2 ">
    <div class="nav-link rounded-0 py-2">
        <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                fill="#D9D9D9" />
            <path
                d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                fill="#D9D9D9" />
        </svg>
        <p class="ms-2 navItemsName">
            Forests
        </p>
    </div>
</li>


            <li class="nav-item mb-2">
              <!-- <a href="" target="_blank" class="nav-link rounded-0 py-2">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_34_5965)">
                    <path
                      d="M12 17.2075C11.8199 17.2075 11.6471 17.1359 11.5197 17.0085C11.3924 16.8811 11.3208 16.7084 11.3208 16.5282V14.7169C11.321 14.5368 11.3926 14.3642 11.52 14.2369L13.3314 12.4256C13.4601 12.3056 13.6304 12.2403 13.8064 12.2434C13.9824 12.2465 14.1503 12.3178 14.2747 12.4422C14.3992 12.5667 14.4705 12.7346 14.4736 12.9105C14.4767 13.0865 14.4113 13.2568 14.2914 13.3856L12.6793 14.9977V16.5282C12.6793 16.7084 12.6077 16.8811 12.4803 17.0085C12.353 17.1359 12.1802 17.2075 12 17.2075Z"
                      fill="#D9D9D9"></path>
                    <path
                      d="M12 15.3962C11.9108 15.3962 11.8225 15.3786 11.7401 15.3444C11.6578 15.3102 11.5829 15.2601 11.52 15.1969L9.70867 13.3856C9.58869 13.2568 9.52337 13.0865 9.52647 12.9105C9.52958 12.7346 9.60086 12.5667 9.72531 12.4422C9.84976 12.3178 10.0177 12.2465 10.1936 12.2434C10.3696 12.2403 10.5399 12.3056 10.6687 12.4256L12.48 14.2369C12.5749 14.3319 12.6395 14.4529 12.6656 14.5846C12.6918 14.7162 12.6783 14.8527 12.627 14.9768C12.5756 15.1008 12.4886 15.2068 12.377 15.2815C12.2655 15.3561 12.1342 15.396 12 15.3962Z"
                      fill="#D9D9D9"></path>
                    <path
                      d="M14.7171 19.9245C14.5369 19.9245 14.3641 19.853 14.2368 19.7256C14.1094 19.5982 14.0378 19.4254 14.0378 19.2453V18.2672C14.0403 17.9833 14.118 17.7053 14.2631 17.4613C14.4082 17.2174 14.6155 17.0164 14.8638 16.8788C15.6129 16.4399 16.2508 15.8345 16.7283 15.1095C17.2058 14.3844 17.51 13.5591 17.6173 12.6976C17.7245 11.8361 17.632 10.9615 17.3469 10.1415C17.0618 9.32144 16.5918 8.57806 15.9732 7.96891C15.4019 7.40396 14.7168 6.96714 13.9636 6.6875C13.2103 6.40786 12.4062 6.29182 11.6046 6.34709C10.803 6.40236 10.0224 6.62768 9.31465 7.00805C8.60691 7.38843 7.98827 7.91514 7.49989 8.55316C7.01151 9.19118 6.66458 9.92587 6.48218 10.7084C6.29978 11.4909 6.28608 12.3033 6.44201 13.0915C6.59794 13.8797 6.91991 14.6256 7.38651 15.2797C7.85311 15.9339 8.45364 16.4811 9.14816 16.8851C9.39367 17.0233 9.59829 17.2239 9.74128 17.4666C9.88426 17.7093 9.96053 17.9855 9.96235 18.2672V19.2453C9.96235 19.4254 9.89079 19.5982 9.7634 19.7256C9.63602 19.853 9.46325 19.9245 9.2831 19.9245C9.10296 19.9245 8.93019 19.853 8.80281 19.7256C8.67542 19.5982 8.60386 19.4254 8.60386 19.2453V18.2672C8.60199 18.224 8.58856 18.1822 8.56498 18.146C8.5414 18.1099 8.50853 18.0807 8.46982 18.0616C7.60926 17.5607 6.86516 16.8823 6.28697 16.0717C5.70878 15.261 5.30975 14.3366 5.11638 13.3598C4.92301 12.383 4.93973 11.3763 5.16545 10.4065C5.39116 9.43666 5.82069 8.52599 6.42549 7.73498C7.03029 6.94397 7.79652 6.29073 8.67325 5.81868C9.54997 5.34663 10.5171 5.06658 11.5104 4.99713C12.5037 4.92768 13.5005 5.07043 14.4343 5.41589C15.3682 5.76135 16.2179 6.3016 16.9269 7.00076C17.592 7.65196 18.1198 8.42988 18.4791 9.28854C18.8385 10.1472 19.022 11.0692 19.019 12C19.0135 13.2241 18.6901 14.4258 18.0805 15.4873C17.4708 16.5488 16.5958 17.4337 15.5412 18.0552C15.5002 18.0742 15.465 18.1039 15.4395 18.1412C15.414 18.1785 15.399 18.222 15.3963 18.2672V19.2453C15.3963 19.4254 15.3247 19.5982 15.1974 19.7256C15.07 19.853 14.8972 19.9245 14.7171 19.9245ZM13.8114 24.4528H10.1888C9.76857 24.4524 9.36572 24.2852 9.0686 23.9881C8.77147 23.691 8.60434 23.2881 8.60386 22.8679V21.9623C8.60386 21.7821 8.67542 21.6093 8.80281 21.482C8.93019 21.3546 9.10296 21.283 9.2831 21.283C9.46325 21.283 9.63602 21.3546 9.7634 21.482C9.89079 21.6093 9.96235 21.7821 9.96235 21.9623V22.8679C9.96305 22.9278 9.98714 22.9849 10.0294 23.0272C10.0718 23.0696 10.1289 23.0936 10.1888 23.0943H13.8114C13.8712 23.0936 13.9284 23.0696 13.9707 23.0272C14.013 22.9849 14.0371 22.9278 14.0378 22.8679V21.9623C14.0378 21.7821 14.1094 21.6093 14.2368 21.482C14.3641 21.3546 14.5369 21.283 14.7171 21.283C14.8972 21.283 15.07 21.3546 15.1974 21.482C15.3247 21.6093 15.3963 21.7821 15.3963 21.9623V22.8679C15.3958 23.2881 15.2287 23.691 14.9316 23.9881C14.6345 24.2852 14.2316 24.4524 13.8114 24.4528Z"
                      fill="#D9D9D9"></path>
                    <path
                      d="M13.1321 24.4528H10.8679C10.6878 24.4528 10.515 24.3813 10.3876 24.2539C10.2602 24.1265 10.1887 23.9537 10.1887 23.7736C10.1887 23.5934 10.2602 23.4207 10.3876 23.2933C10.515 23.1659 10.6878 23.0944 10.8679 23.0944H13.1321C13.3122 23.0944 13.485 23.1659 13.6124 23.2933C13.7398 23.4207 13.8113 23.5934 13.8113 23.7736C13.8113 23.9537 13.7398 24.1265 13.6124 24.2539C13.485 24.3813 13.3122 24.4528 13.1321 24.4528ZM19.2 21.0294C19.0657 21.0293 18.9345 20.9894 18.8229 20.9148C18.7114 20.8401 18.6244 20.7341 18.573 20.6101C18.5217 20.486 18.5082 20.3495 18.5344 20.2178C18.5605 20.0862 18.6251 19.9652 18.72 19.8702L20.323 18.2672C20.3649 18.227 20.3983 18.1788 20.4212 18.1254C20.444 18.072 20.4559 18.0146 20.4562 17.9565C20.4566 17.8964 20.4449 17.8368 20.4219 17.7813C20.3989 17.7257 20.365 17.6754 20.3221 17.6332L19.901 17.203C19.6374 16.9318 19.4643 16.5855 19.4054 16.2119C19.3465 15.8383 19.4048 15.4556 19.5722 15.1164C19.6782 14.88 19.7805 14.6319 19.8756 14.3747C19.9987 14.0161 20.2296 13.7043 20.5366 13.4819C20.8436 13.2594 21.2119 13.1373 21.5909 13.1321H22.1887C22.3088 13.1321 22.424 13.0844 22.5089 12.9995C22.5938 12.9145 22.6415 12.7994 22.6415 12.6793V10.4151C22.6415 10.295 22.5938 10.1798 22.5089 10.0949C22.424 10.01 22.3088 9.96227 22.1887 9.96227H21.5909C21.2124 9.95741 20.8446 9.8358 20.5377 9.61405C20.2309 9.3923 20 9.08123 19.8765 8.72333C19.7826 8.46767 19.6796 8.21544 19.5677 7.9671C19.4022 7.62641 19.3465 7.24279 19.4081 6.86908C19.4697 6.49538 19.6457 6.14998 19.9118 5.88046L20.3185 5.46567C20.3623 5.42308 20.397 5.37209 20.4207 5.31576C20.4444 5.25943 20.4564 5.19891 20.4562 5.13782C20.4561 5.08081 20.4447 5.02439 20.4226 4.97183C20.4006 4.91927 20.3682 4.87164 20.3275 4.83171L18.72 3.22416C18.6798 3.18227 18.6316 3.1489 18.5782 3.12603C18.5248 3.10316 18.4674 3.09125 18.4094 3.09103C18.3483 3.08076 18.2856 3.08789 18.2284 3.1116C18.1713 3.1353 18.1219 3.17462 18.086 3.22507L17.6559 3.6462C17.3847 3.91002 17.0385 4.08329 16.6648 4.14217C16.2911 4.20105 15.9083 4.14263 15.5692 3.97495C15.3256 3.86507 15.0782 3.76387 14.8275 3.67156C14.4689 3.54845 14.1571 3.31761 13.9347 3.01058C13.7123 2.70355 13.5901 2.33532 13.5849 1.95624V1.3585C13.5849 1.2384 13.5372 1.12322 13.4523 1.0383C13.3674 0.95338 13.2522 0.905671 13.1321 0.905671H10.8679C10.7478 0.905671 10.6326 0.95338 10.5477 1.0383C10.4628 1.12322 10.4151 1.2384 10.4151 1.3585V1.95624C10.4102 2.33479 10.2886 2.70262 10.0669 3.00946C9.84512 3.31631 9.53405 3.54722 9.17615 3.67065C8.91532 3.76575 8.66717 3.86809 8.41992 3.97948C8.07929 4.14521 7.6956 4.20112 7.32184 4.13947C6.94807 4.07783 6.60266 3.90167 6.33328 3.63533L5.91849 3.22869C5.87621 3.18522 5.82567 3.15065 5.76983 3.12701C5.714 3.10337 5.65399 3.09113 5.59336 3.09103C5.47824 3.09385 5.36836 3.13974 5.28543 3.21963L3.67698 4.82718C3.63509 4.86739 3.60172 4.91561 3.57885 4.96897C3.55598 5.02234 3.54407 5.07976 3.54385 5.13782C3.54342 5.19794 3.55506 5.25754 3.57808 5.31307C3.60111 5.36861 3.63505 5.41896 3.67789 5.46114L4.09902 5.89133C4.3626 6.1626 4.53572 6.50884 4.59459 6.88247C4.65345 7.2561 4.59518 7.6388 4.42777 7.97797C4.32091 8.21435 4.21947 8.4625 4.12438 8.71971C4.00127 9.07829 3.77043 9.39009 3.4634 9.6125C3.15637 9.83491 2.78814 9.95707 2.40906 9.96227H1.81132C1.69122 9.96227 1.57604 10.01 1.49112 10.0949C1.4062 10.1798 1.35849 10.295 1.35849 10.4151V12.6793C1.35849 12.7994 1.4062 12.9145 1.49112 12.9995C1.57604 13.0844 1.69122 13.1321 1.81132 13.1321H2.40906C2.78761 13.137 3.15544 13.2586 3.46228 13.4803C3.76913 13.7021 4.00004 14.0131 4.12347 14.371C4.21857 14.6319 4.32091 14.88 4.4323 15.1273C4.59777 15.468 4.65352 15.8516 4.59189 16.2253C4.53025 16.599 4.35426 16.9444 4.08815 17.2139L3.68151 17.6287C3.63771 17.6713 3.60295 17.7223 3.5793 17.7786C3.55565 17.8349 3.54359 17.8954 3.54385 17.9565C3.54389 18.0135 3.55528 18.07 3.57736 18.1225C3.59944 18.1751 3.63177 18.2227 3.67245 18.2627L5.28 19.8702C5.39998 19.999 5.4653 20.1693 5.4622 20.3452C5.45909 20.5212 5.38781 20.6891 5.26336 20.8136C5.13891 20.938 4.97101 21.0093 4.79504 21.0124C4.61907 21.0155 4.44876 20.9502 4.32 20.8302L2.71698 19.2272C2.54882 19.0623 2.4152 18.8656 2.32392 18.6485C2.23264 18.4315 2.18554 18.1984 2.18536 17.9629C2.18366 17.7234 2.22972 17.486 2.32085 17.2646C2.41198 17.0432 2.54634 16.8421 2.71608 16.6732L3.12906 16.2521C3.19682 16.1775 3.23982 16.0837 3.25215 15.9836C3.26447 15.8836 3.24552 15.7821 3.19789 15.6933C3.07157 15.4138 2.95527 15.1298 2.84921 14.842C2.81899 14.7463 2.761 14.6619 2.68262 14.5993C2.60424 14.5367 2.50901 14.4989 2.40906 14.4906H1.81132C1.33108 14.4901 0.870638 14.2991 0.531053 13.9595C0.191469 13.6199 0.000479526 13.1595 0 12.6793V10.4151C0.000479526 9.93486 0.191469 9.47442 0.531053 9.13484C0.870638 8.79525 1.33108 8.60426 1.81132 8.60378H2.40906C2.50954 8.59517 2.60517 8.55679 2.68374 8.49355C2.7623 8.43031 2.82023 8.34509 2.85011 8.24877C2.95426 7.96529 3.06928 7.68816 3.19336 7.41103C3.24253 7.32351 3.26368 7.22301 3.25396 7.1231C3.24425 7.02318 3.20413 6.92865 3.13902 6.85224L2.71155 6.41661C2.54282 6.24795 2.40938 6.04735 2.31904 5.82655C2.22869 5.60574 2.18325 5.36914 2.18536 5.13058C2.1859 4.8942 2.2336 4.6603 2.32566 4.44258C2.41772 4.22487 2.5523 4.02771 2.72151 3.86265L4.32 2.26416C4.48485 2.096 4.68157 1.96238 4.89864 1.8711C5.11572 1.77982 5.34881 1.73272 5.5843 1.73254C6.0665 1.73674 6.52848 1.92685 6.87396 2.26326L7.29509 2.67624C7.36979 2.74389 7.46357 2.78681 7.56359 2.79913C7.66362 2.81145 7.765 2.79257 7.85389 2.74507C8.14098 2.61646 8.41811 2.50054 8.70521 2.39639C8.80091 2.36628 8.88546 2.30832 8.94805 2.22992C9.01065 2.15152 9.04844 2.05623 9.0566 1.95624V1.3585C9.05708 0.878256 9.24807 0.417818 9.58766 0.0782333C9.92724 -0.261351 10.3877 -0.45234 10.8679 -0.45282H13.1321C13.6123 -0.45234 14.0728 -0.261351 14.4123 0.0782333C14.7519 0.417818 14.9429 0.878256 14.9434 1.3585V1.95624C14.952 2.05672 14.9904 2.15235 15.0536 2.23092C15.1169 2.30948 15.2021 2.36741 15.2984 2.39729C15.5819 2.50144 15.859 2.61646 16.1362 2.74054C16.2238 2.78933 16.3242 2.81026 16.424 2.80056C16.5239 2.79085 16.6184 2.75096 16.6949 2.6862L17.1306 2.25873C17.2981 2.09119 17.497 1.95845 17.716 1.86814C17.935 1.77784 18.1697 1.73175 18.4066 1.73254H18.4157C18.6524 1.73284 18.8866 1.78042 19.1047 1.87249C19.3227 1.96456 19.5202 2.09926 19.6854 2.26869L21.283 3.86718C21.4512 4.03203 21.5848 4.22875 21.6761 4.44582C21.7674 4.6629 21.8145 4.89599 21.8146 5.13148C21.8163 5.37093 21.7703 5.60832 21.6792 5.82976C21.588 6.05119 21.4537 6.25224 21.2839 6.42114L20.8709 6.84227C20.8032 6.91691 20.7602 7.01069 20.7479 7.11075C20.7355 7.2108 20.7545 7.31222 20.8021 7.40107C20.9307 7.68816 21.0466 7.96529 21.1508 8.25239C21.181 8.34803 21.239 8.43251 21.3174 8.49509C21.3958 8.55766 21.491 8.5955 21.5909 8.60378H22.1887C22.6689 8.60426 23.1294 8.79525 23.4689 9.13484C23.8085 9.47442 23.9995 9.93486 24 10.4151V12.6793C23.9995 13.1595 23.8085 13.6199 23.4689 13.9595C23.1294 14.2991 22.6689 14.4901 22.1887 14.4906H21.5909C21.4905 14.4992 21.3948 14.5376 21.3163 14.6008C21.2377 14.664 21.1798 14.7493 21.1499 14.8456C21.0457 15.1291 20.9307 15.4062 20.8066 15.6833C20.7575 15.7709 20.7363 15.8713 20.746 15.9713C20.7558 16.0712 20.7959 16.1657 20.861 16.2421L21.2885 16.6777C21.4572 16.8464 21.5906 17.047 21.681 17.2678C21.7713 17.4886 21.8168 17.7252 21.8146 17.9638C21.8141 18.2002 21.7664 18.4341 21.6743 18.6518C21.5823 18.8695 21.4477 19.0667 21.2785 19.2317L19.68 20.8302C19.617 20.8934 19.5422 20.9435 19.4599 20.9777C19.3775 21.0119 19.2892 21.0295 19.2 21.0294Z"
                      fill="#D9D9D9"></path>
                    <path
                      d="M15.6227 22.6416H8.37739C7.95719 22.6411 7.55434 22.474 7.25722 22.1768C6.96009 21.8797 6.79296 21.4769 6.79248 21.0567V20.151C6.79296 19.7308 6.96009 19.328 7.25722 19.0308C7.55434 18.7337 7.95719 18.5666 8.37739 18.5661H15.6227C16.0429 18.5666 16.4457 18.7337 16.7428 19.0308C17.04 19.328 17.2071 19.7308 17.2076 20.151V21.0567C17.2071 21.4769 17.04 21.8797 16.7428 22.1768C16.4457 22.474 16.0429 22.6411 15.6227 22.6416ZM8.37739 19.9246C8.31734 19.9246 8.25975 19.9484 8.21729 19.9909C8.17483 20.0334 8.15097 20.091 8.15097 20.151V21.0567C8.15097 21.1167 8.17483 21.1743 8.21729 21.2168C8.25975 21.2592 8.31734 21.2831 8.37739 21.2831H15.6227C15.6827 21.2831 15.7403 21.2592 15.7828 21.2168C15.8252 21.1743 15.8491 21.1167 15.8491 21.0567V20.151C15.8491 20.091 15.8252 20.0334 15.7828 19.9909C15.7403 19.9484 15.6827 19.9246 15.6227 19.9246H8.37739Z"
                      fill="#D9D9D9"></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_34_5965">
                      <rect width="24" height="24" fill="white"></rect>
                    </clipPath>
                  </defs>
                </svg>
                <p class="ms-2 navItemsName">
                  Logs
                </p>
              </a> -->
            </li>

          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>
  </div>
  <div class="content-wrapper min-vh-100">
    <section class="content pb-5">
      <div class="container-fluid pt-3 pe-lg-3 ps-1 pe-1 InspectionDashboard" style="margin-top: -30px;">
        <div class="dashboardHeading mb-4" style="margin-top: 0px;">
          <h4>Statistics</h4>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="yearFilter" class="form-label">Year:</label>
              <select id="yearFilter" class="form-select">
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="monthFilter" class="form-label">Month (Optional):</label>
              <select id="monthFilter" class="form-select">
                <option value="">All Months</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
            </div>
            <div class="col-md-4">
            <div id="totalCount">
                <span style="font-size: 16px; margin-right: 5px; vertical-align: middle;">Total Incidents:</span>
                <div id="totalFireIncidentsCardValue" style="font-size: 28px; font-weight: bold; display: inline-block; vertical-align: middle;">
                </div>
            </div>
        </div>
        </div>
          <!-- <h5>Dashboard &gt; Home</h5> -->
        </div>
        <div class="row mb-3 px-2">
          <div class="col-md-4 mb-4">
            <div class="card l-bg-cherry" onclick="openNewPage('Northern Zone')">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0">Northern Zone Incidents</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id=NorthernZoneIncidents>

                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>

                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-cyan" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-2">
            <div class="card l-bg-blue-dark" onclick="openNewPage('Central Zone')">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0">Central Zone Incidents</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id="CentralZoneIncidents">
                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>
                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-green" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-2">
            <div class="card l-bg-warning" onclick="openNewPage('Southern Zone')">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0">Southern Zone Incidents</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id="SouthernZoneIncidents">

                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>
                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-green" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-3 px-2">
          <div class="col-md-4 mb-4">
            <div class="card l-bg-danger" onclick="openNewPage3()">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0">Northern Zone Affected Area (Ac.)</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id="NorthernZoneEffected">

                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>

                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-cyan" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-2">
            <div class="card l-bg-green-dark" onclick="openNewPage4()">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0"> Central Zone Affected Area (Ac.)</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id="CentralZoneEffected">

                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>
                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-orange" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-2">
            <div class="card l-bg-orange-dark" onclick="openNewPage5()">
              <div class="card-statistic-3 p-4">
                <div class="card-icon card-icon-large"><i class="fas fa-fire fa-fw"></i></div>
                <div class="mb-4">
                  <h5 class="card-title mb-0">Southern Zone Affected Area (Ac.)</h5>
                </div>
                <div class="row align-items-center mb-2 d-flex">
                  <div class="col-8">
                    <h2 class="d-flex align-items-center mb-0" id="SouthernZoneEffected">
                      <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca1b322-treefire.png" alt="tree fire" width="50">
                    </h2>
                  </div>
                </div>
                <div class="progress mt-1 " data-height="8" style="height: 8px;">
                  <div class="progress-bar l-bg-cyan" role="progressbar" data-width="25%" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100" style="width: 25%;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-lg-6 col-md-12 col-sm-12">
          <div class="card border-0 shadow-none"
            style="height: 700px; display: flex; flex-direction: column; overflow: hidden;">
            <div class="row border-bottom mb-8 px-1 align-items-center ">
              <div class="col-lg-6 mb-2"></div>
              <div class="col-lg-6 mb-2"></div>
            </div>
            <div class="card-body border-0"
              style="padding: 1rem 0.7rem; flex: 1; display: flex; flex-direction: column;">
              <div class="row border-bottom mb-2 px-1 align-items-center userManagementInspectionPage">
                <div class="col-12 text-center">
                  <h2>Division Wise Summary</h2>
                </div>
              </div>
              <div class="tables available-plants container-fluid table-responsive"
                style="flex: 1; overflow-y: auto; width: 100%; max-height: 600px;">
                <div class="row">
                  <div class="table-card" style="height: 100%; display: flex; flex-direction: column;">
                    <table class="table table-striped" id="zone_activities_table"
                      style="width: 100%; border-collapse: collapse;">
                      <thead class="thead-primary"
                        style="position: sticky; top: 0; background-color: white; z-index: 10;">
                        <tr>
                          <th class="text-left" scope="col">Sr.</th>
                          <th class="text-left" scope="col">Division</th>
                          <th class="text-left" scope="col">Incidents</th>
                        </tr>
                      </thead>
                      <tbody id="tableBodyIncidents">
                      </tbody>

                    </table>
                  </div>
                </div>
              </div>

            </div>

          </div>

        </div>
        <div class="col-lg-6 col-md-12 col-sm-12">
          <div class="card border-0 shadow-none">
            <div class="card-body border-0" style="padding: 1rem 0.7rem; min-height: 350px; max-height: 450px;">
              <div class="row border-bottom mb-5 px-1 align-items-center userManagementInspectionPage ">
                <div class="col">
                  <h2>Month Wise <span id="activity_percentage_user_name">Fire</span> Incidents</h2>
                </div>
              </div>
              <figure class="highcharts-figure">
                <div id="activity_percentage_graph"></div>
                <p class="highcharts-description">

                </p>
              </figure>
            </div>

            <div class="card-body border-0" style="padding: 1rem 0.7rem; min-height: 350px; max-height: 450px;">
              <div class="row border-bottom mb-5 px-1 align-items-center userManagementInspectionPage ">
                <div class="col">
                  <h2>Yearly <span id="activity_percentage_user_name">Zone</span> Wise Trend</h2>
                </div>
              </div>
              <figure class="highcharts-figure">
                <div id="activity_percentage_graph2"></div>
                <p class="highcharts-description">

                </p>
              </figure>
            </div>
          </div>
        </div>



      </div>





      <div class="row mb-4" id="sidebar-left">
        <div class="col-md-3 mb-4" id="mySidebar" class="sidenav">
          <select name="state" id="zoneSel" class="form-select">
            <option value="zone" selected="selected">Select Zone</option>
          </select>
        </div>

        <div class="col-md-3 mb-4">
          <select name="country" id="circleSel" size="1" class="form-select">
            <option value="circle" selected="selected">Select Circle</option>
          </select>
        </div>

        <div class="col-md-3 mb-4">
          <select name="district" id="divisionSel" size="1" class="form-select">
            <option value="division" selected="selected">
              Select Division
            </option>
          </select>
        </div>

        <div class="col-md-3 mb-4">
          <select name="forest" id="forestSel" size="1" class="form-select">
            <option value="">Select Forest</option>
          </select>
        </div>
        <div class="col-md-2 mb-4">
          <input type="text" class="form-control dateInput" value="" id="startdate" placeholder="Start Date" readonly>
        </div>
        <div class="col-md-2 mb-4">
          <input type="text" class="form-control dateInput" value="" id="enddate" placeholder="End Date" readonly>
        </div>
        <div class="col-md-2 mb-4">
          <button id="b_search"
            class="btn btn-primary col-md-12 text-decoration-none d-inline-flex align-items-center justify-content-center px-4">
            <span>
              <i class="bi bi-search pe-2 fw-bolder "></i>
            </span> Search
          </button>
        </div>
        <div class="col-md-3 mb-4">
          <button onclick="resetValues(), clearMap()" type="button" class="btn btn-warning w-100"> Reset</button>
        </div>
        <div class="col-md-3 mb-4">
          <button id="captureBtn" class="btn btn-success w-100">Generate Report</button>

        </div>

      </div>

      <div class="row mb-3">
        <div class="col">
          <div class="card border-0 shadow-none ">
            <div class="card-body border-0" style="padding: 1rem 0.7rem;">
              <div class="row border-bottom mb-3 px-1 align-items-center userManagementInspectionPage ">
                <div class="col-6">
                  <h2>Map</h2>
                </div>
              </div>

              <div class="map">

                <div id="map" style="height: 600px;"></div>

              </div>
            </div>
          </div>
        </div>
      </div>

  </div>
  </section>
  <!-- /.content -->
  </div>

  <div class="attachmentModal">
    <div class="modal fade" id="attachmentModal" tabindex="-1" aria-labelledby="attachmentModalLabel" aria-modal="true"
      role="dialog">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body pt-5 pb-0">
            <img id="imageModal" style="width: 100%" />
          </div>
          <div class="modal-footer border-0 pb-4 justify-content-center pt-0">
            <button type="button" class="btn modalCancelBtn bg-transparent me-3" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="logoutModal">
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-modal="true"
      role="dialog">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body pt-5 pb-0">
            <div class="modalIcon text-center pb-4">
              <svg xmlns="http://www.w3.org/2000/svg" width="42" height="36" viewBox="0 0 42 36" fill="none">
                <path
                  d="M34.3 20H10V16H34.3L31.2 12.9L34 10L42 18L34 26L31.2 23.1L34.3 20ZM24 12V4H4V32H24V24H28V32C28 33.1 27.6083 34.0417 26.825 34.825C26.0417 35.6083 25.1 36 24 36H4C2.9 36 1.95833 35.6083 1.175 34.825C0.391667 34.0417 0 33.1 0 32V4C0 2.9 0.391667 1.95833 1.175 1.175C1.95833 0.391667 2.9 0 4 0H24C25.1 0 26.0417 0.391667 26.825 1.175C27.6083 1.95833 28 2.9 28 4V12H24Z"
                  fill="#333333"></path>
              </svg>
            </div>
            <h3 class="modalPermissionHeading mb-3">Are you sure you want to log out?</h3>
          </div>
          <!-- <div class="modal-footer border-0 pb-4 justify-content-center pt-0">
            <button type="button" class="btn modalCancelBtn bg-transparent me-3" data-bs-dismiss="modal">Cancel</button>
            <a href="" onclick="event.preventDefault();
                       document.getElementById('logout-form').submit();" class="btn modalLogoutBtn ms-3">Logout</a>
            <form id="logout-form" action="" method="POST" class="d-none">
              <input type="hidden" name="_token" value="YoIkc4bBr4HMTVCE0mT8tUfvbcyfI0xzAbtWc7DT">
            </form>
          </div> -->
        </div>
      </div>
    </div>
  </div>
  <div class="alertModal">
    <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-modal="true"
      role="dialog">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <div class="modal-body pt-5 pb-0">
            <div class="modalIcon text-center pb-4">
              <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M9 4.75H15C15.0663 4.75 15.1299 4.72366 15.1768 4.67678C15.2237 4.62989 15.25 4.5663 15.25 4.5V1.25H8.75V4.5C8.75 4.5663 8.77634 4.62989 8.82322 4.67678C8.87011 4.72366 8.9337 4.75 9 4.75Z"
                  fill="#D9D9D9" />
                <path
                  d="M18.5 1.25H16.75V4.5C16.7474 4.96332 16.5622 5.40691 16.2345 5.73454C15.9069 6.06216 15.4633 6.24737 15 6.25H9C8.53668 6.24737 8.09309 6.06216 7.76546 5.73454C7.43784 5.40691 7.25263 4.96332 7.25 4.5V1.25H5.5C4.90326 1.25 4.33097 1.48705 3.90901 1.90901C3.48705 2.33097 3.25 2.90326 3.25 3.5V20.5C3.25 21.0967 3.48705 21.669 3.90901 22.091C4.33097 22.5129 4.90326 22.75 5.5 22.75H18.5C19.0967 22.75 19.669 22.5129 20.091 22.091C20.5129 21.669 20.75 21.0967 20.75 20.5V3.5C20.75 2.90326 20.5129 2.33097 20.091 1.90901C19.669 1.48705 19.0967 1.25 18.5 1.25ZM16 18.75H8C7.80109 18.75 7.61032 18.671 7.46967 18.5303C7.32902 18.3897 7.25 18.1989 7.25 18C7.25 17.8011 7.32902 17.6103 7.46967 17.4697C7.61032 17.329 7.80109 17.25 8 17.25H16C16.1989 17.25 16.3897 17.329 16.5303 17.4697C16.671 17.6103 16.75 17.8011 16.75 18C16.75 18.1989 16.671 18.3897 16.5303 18.5303C16.3897 18.671 16.1989 18.75 16 18.75ZM16 14.75H8C7.80109 14.75 7.61032 14.671 7.46967 14.5303C7.32902 14.3897 7.25 14.1989 7.25 14C7.25 13.8011 7.32902 13.6103 7.46967 13.4697C7.61032 13.329 7.80109 13.25 8 13.25H16C16.1989 13.25 16.3897 13.329 16.5303 13.4697C16.671 13.6103 16.75 13.8011 16.75 14C16.75 14.1989 16.671 14.3897 16.5303 14.5303C16.3897 14.671 16.1989 14.75 16 14.75ZM16 10.75H8C7.80109 10.75 7.61032 10.671 7.46967 10.5303C7.32902 10.3897 7.25 10.1989 7.25 10C7.25 9.80109 7.32902 9.61032 7.46967 9.46967C7.61032 9.32902 7.80109 9.25 8 9.25H16C16.1989 9.25 16.3897 9.32902 16.5303 9.46967C16.671 9.61032 16.75 9.80109 16.75 10C16.75 10.1989 16.671 10.3897 16.5303 10.5303C16.3897 10.671 16.1989 10.75 16 10.75Z"
                  fill="#D9D9D9" />
              </svg>
            </div>
            <h3 class="modalPermissionHeading mb-3" id="alertModalMessage"></h3>
          </div>
          <div class="modal-footer border-0 pb-4 justify-content-center pt-0">
            <button type="button" class="btn modalCancelBtn bg-transparent" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>

    // Function to create the Highcharts chart
    function createActivityChart(data) {
      // Prepare the data for the chart
      const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      const categories = data.map(item => monthNames[item.month - 1]); // Extract month names
      const activityPercentages = data.map(item => item.fire_incident_count); // Extract incident counts

      // Create the chart
      Highcharts.chart('activity_percentage_graph', {
        chart: {
          height: 210
        },
        title: {
          text: '',
        },
        credits: {
          enabled: false
        },
        xAxis: {
          categories: categories // Use the extracted month names
        },
        yAxis: {
          min: 0,
          max: 100,
          title: {
            text: 'No. of Incidents'
          }
        },
        tooltip: {
          valueSuffix: ''
        },
        plotOptions: {
          column: {
            pointPadding: 0.2,
            borderWidth: 0
          }
        },
        series: [{
          type: 'column',
          name: 'Month',
          data: activityPercentages // Use the extracted incident counts
        }]
      });
    };

    function createDynamicActivityTrend(seriesData) {
      // Create the chart
      Highcharts.chart('activity_percentage_graph2', {
        chart: {
          height: 210
        },
        title: {
          text: '',
        },
        yAxis: {
          title: {
            text: 'No. of Incidents'
          }
        },
        xAxis: {
          accessibility: {
            rangeDescription: 'Range: 2016 to 2022'
          }
        },
        legend: {
          align: 'center',
          verticalAlign: 'bottom',
          x: 0,
          y: 0
        },
        plotOptions: {
          series: {
            label: {
              connectorAllowed: false
            },
            pointStart: 2019// Adjust this if your data starts from a different year
          }
        },
        series: seriesData, // Use the passed series data
        responsive: {
          rules: [{
            condition: {
              maxWidth: 500
            },
            chartOptions: {
              legend: {
                layout: 'horizontal',
                align: 'center',
                verticalAlign: 'bottom'
              }
            }
          }]
        }
      });
    }


    let currentBoundary = {
      type: null,
      name: null
    };
    let globalTable = "";
    let resourceLayers = {};
    let resource_checked = "";
    let bufferRadius = null;
    let bufferMarker = null;
    // Global storage for all resources data
    let resourceStorage = {};
    let incidentsStorage = [];


    $(document).ready(function () {
      function toggleSidebar(side) {
        if (side !== "left") {
          return false;
        }
        var left = $("#sidebar-left"),
          content = $("#content"),
          buttonTog = $("#togglebtn"),
          openSidebarsCount = 0,
          contentClass = "";

        // toggle sidebar
        if (side === "left") {
          left.toggleClass("collapsed");
        }

        // determine number of open sidebars
        if (!left.hasClass("collapsed")) {
          openSidebarsCount += 1;
        }

        // determine appropriate content class
        if (openSidebarsCount === 0) {
          contentClass = "col-md-12 col-sm-12 col-xs-12";
          buttonTog
            .removeClass("fa fa-arrow-left")
            .addClass("fa fa-arrow-right");
        } else if (openSidebarsCount === 1) {
          contentClass = "col-md-9 col-sm-9 col-xs-9";
          buttonTog
            .removeClass("fa fa-arrow-right")
            .addClass("fa fa-arrow-left");
        } else {
          contentClass = "col-md-6 col-sm-6 col-xs-6";
        }

        content
          .removeClass(
            "col-md-12 col-sm-12 col-xs-12 col-md-9 col-sm-9 col-xs-9 col-md-6"
          )
          .addClass(contentClass);
      }
      $(".toggle-sidebar-left").click(function () {
        toggleSidebar("left");

        return false;
      });
      $(".toggle-sidebar-right").click(function () {
        toggleSidebar("right");

        return false;
      });
    });

    // Function to fetch zones from the API and populate the dropdown
    function fetchZones() {
      fetch('APIs/fetch_zones.php')
        .then(response => {
          //console.log('Zones API Response:', response); // Debugging line
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          //console.log('Zones Data:', data); // Debugging line
          if (data.status === "success") {
            const zoneDropdown = document.getElementById('zoneSel');
            zoneDropdown.innerHTML = '<option value="" selected="selected">Select Zone</option>';
            data.data.forEach(zone => {
              const option = document.createElement('option');
              option.value = zone;
              option.textContent = zone;
              zoneDropdown.appendChild(option);
            });
          } else {
            console.error('Error fetching zones:', data.message);
          }
        })
        .catch(error => console.error('Error fetching zones:', error));
    }

    // Function to fetch circles based on the selected zone
    function fetchCircles(forest_zone) {
      fetch(`APIs/fetch_circles.php?forest_zone=${encodeURIComponent(forest_zone)}`)
        .then(response => {

          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          //console.log('Circles Data:', data); // Debugging line
          if (data.status === "success") {
            const circleDropdown = document.getElementById('circleSel');
            circleDropdown.innerHTML = '<option value="" selected="selected">Select Circle</option>';
            data.data.forEach(circle => {
              const option = document.createElement('option');
              option.value = circle;
              option.textContent = circle;
              circleDropdown.appendChild(option);
            });
          } else {
            console.error('Error fetching circles:', data.message);
          }
        })
        .catch(error => console.error('Error fetching circles:', error));
    }

    // Fetch zones when the page loads
    document.addEventListener('DOMContentLoaded', fetchZones);

    // Event listener for zone dropdown change
    document.getElementById('zoneSel').addEventListener('change', function () {
      const selectedZone = this.value;
      zone_name = selectedZone;
      if (selectedZone) {
        currentBoundary = { type: 'zone', name: selectedZone }; // Update currentBoundary
        zoneFunction(selectedZone);
        fetchCircles(selectedZone);
      } else {
        currentBoundary = { type: null, name: null }; // Reset currentBoundary
        document.getElementById('circleSel').innerHTML = '<option value="" selected="selected">Select Circle</option>';
        document.getElementById('divisionSel').innerHTML = '<option value="" selected="selected">Select Division</option>';
      }
    });

    function fetchDivisions(forest_circle) {
      //console.log('Selected Circle:', forest_circle); // Debugging line
      if (!forest_circle) {
        console.error('No circle selected');
        return;
      }

      fetch(`APIs/fetch_divisions.php?forest_circle=${encodeURIComponent(forest_circle)}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === "success") {
            const divisionDropdown = document.getElementById('divisionSel');
            divisionDropdown.innerHTML = '<option value="" selected="selected">Select Division</option>';
            data.data.forEach(division => {
              const option = document.createElement('option');
              option.value = division;
              option.textContent = division;
              divisionDropdown.appendChild(option);
            });
          } else {
            console.error('Error fetching divisions:', data.message);
          }
        })
        .catch(error => console.error('Error:', error));
    }

    // Event listener for circle dropdown change
    document.getElementById('circleSel').addEventListener('change', function () {
      const selectedCircle = this.value;
      if (selectedCircle) {
        currentBoundary = { type: 'circle', name: selectedCircle }; // Update currentBoundary
        circleFunction(selectedCircle);
        fetchDivisions(selectedCircle);
      } else {
        currentBoundary = { type: null, name: null }; // Reset currentBoundary
        document.getElementById('divisionSel').innerHTML = '<option value="" selected="selected">Select Division</option>';
      }
    });

    // Event listener for division dropdown change
    document.getElementById('divisionSel').addEventListener('change', function () {
      const selectedDivision = this.value;
      if (selectedDivision) {
        currentBoundary = { type: 'division', name: selectedDivision }; // Update currentBoundary
        divisionFunction(selectedDivision);
      } else {
        currentBoundary = { type: null, name: null }; // Reset currentBoundary
      }
    });

    // Function to fetch forests based on the selected division (or all forests if no division is selected)
    function fetchForests(forest_division) {
      let apiUrl = 'APIs/fetch_forests.php';
      if (forest_division) {
        apiUrl += `?forest_division=${encodeURIComponent(forest_division)}`;
      }

      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          //console.log('Forests Data:', data); // Debugging line
          if (data.status === "success") {
            const forestDropdown = document.getElementById('forestSel');
            forestDropdown.innerHTML = '<option value="" selected="selected">Select Forest</option>';
            data.data.forEach(forest => {
              const option = document.createElement('option');
              option.value = forest.unique_id;
              option.textContent = forest.forest_name;
              forestDropdown.appendChild(option);
            });
          } else {
            console.error('Error fetching forests:', data.message);
          }
        })
        .catch(error => console.error('Error fetching forests:', error));
    }

    // Event listener for division dropdown change
    document.getElementById('divisionSel').addEventListener('change', function () {
      //console.log(this.value, 'Division');
      fetchForests(this.value);
    });

    // Initial call to fetch all forests when the page loads
    fetchForests(); // Call without any argument to fetch all forests

    function resetValues() {
      // Reset dropdowns
      resetDropdown("zoneSel", "Select Zone");
      resetDropdown("circleSel", "Select Circle");
      resetDropdown("divisionSel", "Select Division");
      resetDropdown("forestSel", "Select Forest");

      // Clear the map (assuming you have a Leaflet map object named 'map')
      if (map) { // Check if the map object exists
        map.eachLayer(function (layer) {
          if (layer instanceof L.Marker || layer instanceof L.Polygon || layer instanceof L.Polyline || layer instanceof L.Circle || layer instanceof L.GeoJSON) {
            map.removeLayer(layer);
          }
        });

        // Reset map view
        map.setView([30.375321, 69.345116], 5);
      }

      // Re-fetch zones to repopulate the zone dropdown
      fetchZones();
    }


    // Function to reset a dropdown to its default option
    function resetDropdown(dropdownId, defaultText) {
      const dropdown = document.getElementById(dropdownId);
      if (dropdown) {
        dropdown.innerHTML = `<option value="" selected="selected">${defaultText}</option>`;
      }
    }


    //Map initialization.

    try {
      var mapOptions = {
        center: [30.375321, 69.345116],
        zoom: 6,
        zoomControl: false
      };

      var map = new L.map("map", mapOptions);
      var layer = new L.TileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      );
      map.addLayer(layer);

      //TILE, WMS AND OSM LAYER.
      //

      var osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      });
      osm.addTo(map);
      // map.addLayer(osm)

      // water color
      var watercolor = L.tileLayer(
        "https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}",
        {
          attribution:
            'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          subdomains: "abcd",
          minZoom: 1,
          maxZoom: 16,
          ext: "jpg",
        }
      );
      // watercolor.addTo(map)

      // dark map
      var dark = L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
        {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: "abcd",
          maxZoom: 19,
        }
      );
      // dark.addTo(map)

      // google street
      googleStreets = L.tileLayer(
        "https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
        {
          maxZoom: 20,
          subdomains: ["mt0", "mt1", "mt2", "mt3"],
        }
      );
      // googleStreets.addTo(map);

      //google satellite
      googleSat = L.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
        maxZoom: 20,
        subdomains: ["mt0", "mt1", "mt2", "mt3"],
      });
      // googleSat.addTo(map)


      var baseMaps = {
        "OSM": osm,
        "Dark": dark,
        "Google Street": googleStreets,
        "Google Satellite": googleSat,
        "Water Color Map": watercolor,
      };
      var overlayMaps = {
        //All Plantations Details.
      };
      L.control.zoom({
        position: 'bottomright'
      }).addTo(map);
      L.control.layers(baseMaps, overlayMaps, { collapsed: true }).addTo(map);
      var controlLoader = L.control.loader().addTo(map);


      // Global variable to store the blob
      let globalBlob = null;

      // Define a custom control
      const CaptureControl = L.Control.extend({
        options: {
          position: 'bottomright' // Position of the control on the map
        },

        onAdd: function (map) {
          const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
          const button = L.DomUtil.create('button', 'capture-button', container);
          button.innerHTML = 'Capture Map for Report';
          button.title = 'Capture Map and Generate Report';
          // init plugin
          var simpleMapScreenshoter = L.simpleMapScreenshoter({
            cropImageByInnerWH: false, // crop blank opacity from image borders
            hidden: false, // hide screen icon
            preventDownload: false, // prevent download on button click
            domtoimageOptions: {}, // see options for dom-to-image
            position: 'topleft', // position of take screen icon
            screenName: 'screen', // string or function
            mimeType: 'image/png', // used if format == image,
            caption: null, // string or function, added caption to bottom of screen
            captionFontSize: 15,
            captionFont: 'Arial',
            captionColor: 'black',
            captionBgColor: 'white',
            captionOffset: 5,
            onPixelDataFail: async function ({ node, plugin, error, mapPane, domtoimageOptions }) {
              return plugin._getPixelDataOfNormalMap(domtoimageOptions)
            }
          }).addTo(map)

          // Add click event to the button
          L.DomEvent.on(button, 'click', () => {
            resetCapturedMap();
            // Use simpleMapScreenshoter to capture the map as a blob
            simpleMapScreenshoter.takeScreen('blob')
              .then(blob => {
                // Store the blob in the global variable
                globalBlob = blob;
                //console.log('Map captured and stored in globalBlob:', globalBlob);
              })
              .catch(e => {
                console.error('Error capturing map:', e);
              });
          });

          L.DomEvent.disableClickPropagation(button);
          return container;
        }
      });

      // Add the custom control to the map
      map.addControl(new CaptureControl());
      // L.simpleMapScreenshoter().addTo(map)

      // create the control
      var command = L.control({ position: 'bottomleft' }); // Move to top-right for better visibility

      // --------------REsources and Buffer-------------------
// Field Staff Type Configuration
const fieldStaffTypes = {
    'dfo': { 
        name: 'fieldstaff', 
        type: 'DFO',
        displayName: 'DFO'
    },
    'sdfo': { 
        name: 'fieldstaff', 
        type: 'SDFO',
        displayName: 'SDFO' 
    },
    'rfo': { 
        name: 'fieldstaff', 
        type: 'RFO',
        displayName: 'RFO' 
    },
    'block_officer': { 
        name: 'fieldstaff', 
        type: 'Block Officer',
        displayName: 'Block Officer' 
    },
    'forest_guard': { 
        name: 'fieldstaff', 
        type: 'Forest Guard',
        displayName: 'Forest Guard' 
    }
};

// Command Control Creation
command.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'command collapsible');
    div.id = "resourceControl";

    div.innerHTML = `
<div class="collapsible-header" onclick="toggleCollapsible()">Select Resources ▼</div>
    <div class="collapsible-content">
        <div class="container">
            <div class="col-sm">
                <label class="checkbox-label">
                    <input type="checkbox" id="selectAll" onclick="selectAllResources(this.checked)">
                    Select All
                </label>
                
                <!-- Individual Resources -->
                <label class="checkbox-label">
                    <input type="checkbox" id="firewatcher" onclick="myFunction(this.id)">
                    <img src="http://maps.google.com/mapfiles/kml/shapes/hiker.png" class="resource-icon">
                    Fire Watcher
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="watertank" onclick="myFunction(this.id)">
                    <img src="http://maps.google.com/mapfiles/kml/shapes/water.png" class="resource-icon">
                    Water Tank
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="checkpost" onclick="myFunction(this.id)">
                    <img src="http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png" class="resource-icon">
                    Check Post
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="waterhydrants" onclick="myFunction(this.id)">
                    <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da088e9a1d-hydrant.png" class="resource-icon">
                    Water Hydrant
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="watchtower" onclick="myFunction(this.id)">
                    <img src="http://maps.google.com/mapfiles/kml/shapes/ranger_station.png" class="resource-icon">
                    Watch Tower
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="firefighter" onclick="myFunction(this.id)">
                    <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cea68e1-firefighter.png" class="resource-icon">
                    Fire Fighter
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="rescue" onclick="myFunction(this.id)">
                    <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c78b2ac-rescue.png" class="resource-icon">
                    Rescue 1122 Stations
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="healthcenters" onclick="myFunction(this.id)">
                    <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da088408c5-hospital.png" class="resource-icon">
                    Health Centers
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="volunteers" onclick="myFunction(this.id)">
                    <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca8de88-volunteer.png" class="resource-icon">
                    Volunteers
                </label>
                
                <!-- Field Formations Group -->
                <div class="resource-group">
                    <label class="checkbox-label group-header">
                        <input type="checkbox" id="field_formations" onclick="toggleFieldFormations(this.checked)">
                        Field Formations
                    </label>
                    <div class="sub-resources">
                        <label class="checkbox-label">
                            <input type="checkbox" id="dfo" onclick="myFunction(this.id)">
                            <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cd2b716-dfo.png" class="resource-icon">
                            DFO
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="sdfo" onclick="myFunction(this.id)">
                            <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c9997d0-sdfo.png" class="resource-icon">
                            SDFO
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="rfo" onclick="myFunction(this.id)">
                            <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c824e11-rfo.png" class="resource-icon">
                            RFO
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="block_officer" onclick="myFunction(this.id)">
                            <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cc9fa19-block_officer.png" class="resource-icon">
                            Block Officer
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="forest_guard" onclick="myFunction(this.id)">
                            <img src="https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da084d225f-forest_guard.png" class="resource-icon">
                            Forest Guard
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
`;
    return div;
};

// Function to toggle Field Formations group
function toggleFieldFormations(isChecked) {
    const subResources = Object.keys(fieldStaffTypes);
    
    // Check zone/buffer first
    if (isChecked && bufferRadius <= 0 && typeof zone_name === 'undefined') {
        alert("Please select a zone or apply a buffer first!");
        document.getElementById('field_formations').checked = false;
        return;
    }

    subResources.forEach(id => {
        document.getElementById(id).checked = isChecked;
        if (isChecked) {
            if (!resourceLayers[id]) {
                myFunction(id, true); // Suppress alerts
            }
        } else {
            if (resourceLayers[id]) {
                map.removeLayer(resourceLayers[id]);
                delete resourceStorage[id];
            }
        }
    });
    
    updateSelectAllCheckbox();
}

// Select All Resources function
function selectAllResources(isChecked) {
    const allResources = [
        'firewatcher', 'watertank', 'checkpost', 'waterhydrants',
        'watchtower', 'firefighter', 'rescue', 'healthcenters', 'volunteers',
        ...Object.keys(fieldStaffTypes)
    ];

    if (isChecked && bufferRadius <= 0 && typeof zone_name === 'undefined') {
        alert("Please select a zone or apply a buffer first!");
        document.getElementById('selectAll').checked = false;
        return;
    }

    allResources.forEach(id => {
        document.getElementById(id).checked = isChecked;
    });

    document.getElementById('field_formations').checked = isChecked;

    allResources.forEach(id => {
        if (isChecked) {
            if (!resourceLayers[id]) {
                myFunction(id, true);
            }
        } else {
            if (resourceLayers[id]) {
                map.removeLayer(resourceLayers[id]);
                delete resourceStorage[id];
            }
        }
    });
}

// Update Select All checkbox state
function updateSelectAllCheckbox() {
    const allCheckboxes = [
        'firewatcher', 'watertank', 'checkpost', 'waterhydrants',
        'watchtower', 'firefighter', 'rescue', 'healthcenters', 'volunteers',
        ...Object.keys(fieldStaffTypes)
    ];
    
    const allChecked = allCheckboxes.every(id => document.getElementById(id).checked);
    document.getElementById('selectAll').checked = allChecked;
}

function myFunction(resourceId, suppressAlert = false) {
    // Field Staff Type Configuration
    const fieldStaffTypes = {
        'dfo': { name: 'fieldstaff', type: 'DFO', displayName: 'DFO' },
        'sdfo': { name: 'fieldstaff', type: 'SDFO', displayName: 'SDFO' },
        'rfo': { name: 'fieldstaff', type: 'RFO', displayName: 'RFO' },
        'block_officer': { name: 'fieldstaff', type: 'Block Officer', displayName: 'Block Officer' },
        'forest_guard': { name: 'fieldstaff', type: 'Forest Guard', displayName: 'Forest Guard' }
    };

    // Determine resource parameters
    const isFieldStaff = fieldStaffTypes[resourceId];
    const resourceName = isFieldStaff ? fieldStaffTypes[resourceId].name : resourceId;
    const staffType = isFieldStaff ? fieldStaffTypes[resourceId].type : null;
    const displayName = isFieldStaff ? fieldStaffTypes[resourceId].displayName : resourceId;

    // Check zone/buffer selection
    if (!suppressAlert && bufferRadius <= 0 && typeof zone_name === 'undefined') {
        alert("Please select a zone or apply a buffer first!");
        document.getElementById(resourceId).checked = false;
        return;
    }

    // Update checkbox states
    if (isFieldStaff) updateFieldFormationsCheckbox();
    updateSelectAllCheckbox();

    if (document.getElementById(resourceId).checked) {
        controlLoader.show();
        resource_checked = resourceId;
        const controlDiv = document.getElementById("resourceControl");
        controlDiv.classList.add("disabled");

        // Build API URL
        let apiUrl = `APIs/get_resources.php?resource_name=${resourceName}`;
        if (bufferRadius > 0) {
            apiUrl += `&marker=${bufferMarker}&buffer_radius=${bufferRadius}`;
        } else {
            apiUrl += `&zone_name=${zone_name}`;
        }
        if (staffType) apiUrl += `&staff_type=${encodeURIComponent(staffType)}`;

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                controlLoader.hide();
                controlDiv.classList.remove("disabled");

                if (!data?.data?.length) {
                    console.log(`No resources found for: ${resourceId}`);
                    return;
                }

                if (data.status !== "success") {
                    throw new Error(data.message || "API request failed");
                }

                // Process API data into GeoJSON
                const geoJsonData = {
                    type: "FeatureCollection",
                    features: data.data.map(item => {
                        try {
                            const properties = item.resource_data ? 
                                JSON.parse(item.resource_data) : 
                                {
                                    name: item.name || displayName,
                                    f_division: item.division || '',
                                    contact_no: item.contact_no || '',
                                    jurisdiction_area: item.jurisdiction_area || ''
                                };

                            let coordinates;
                            
                            // Try to get coordinates from WKB geometry first
                            if (item.geom) {
                                coordinates = parseWkbGeometry(item.geom);
                            }
                            
                            // Fallback to explicit coordinates
                            if (!coordinates && item.coordinates) {
                                coordinates = [
                                    parseFloat(item.coordinates.longitude),
                                    parseFloat(item.coordinates.latitude)
                                ];
                            }
                            
                            // Final fallback to properties
                            if (!coordinates && properties.longitude && properties.latitude) {
                                coordinates = [
                                    parseFloat(properties.longitude),
                                    parseFloat(properties.latitude)
                                ];
                            }

                            if (!coordinates || coordinates.some(isNaN)) {
                                console.error('Invalid coordinates for item:', item);
                                return null;
                            }

                            return {
                                type: "Feature",
                                geometry: {
                                    type: "Point",
                                    coordinates: coordinates
                                },
                                properties: properties
                            };
                        } catch (e) {
                            console.error('Error processing item:', item, 'Error:', e);
                            return null;
                        }
                    }).filter(feature => feature !== null)
                };

                // Create and add layer to map
                try {
                    const layer = L.geoJSON(geoJsonData, {
                        pointToLayer: (feature, latlng) => {
                            return L.marker(latlng, {
                                icon: customIcons[resourceId] || defaultIcon
                            });
                        },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties;
                            let popupContent = `<b>${displayName}</b><br>`;
                            
                            if (props.name) popupContent += `<b>Name:</b> ${props.name}<br>`;
                            if (props.f_division) popupContent += `<b>Division:</b> ${props.f_division}<br>`;
                            if (props.contact_no) popupContent += `<b>Contact:</b> ${props.contact_no}<br>`;
                            if (props.jurisdiction_area) popupContent += `<b>Area:</b> ${props.jurisdiction_area}`;
                            
                            layer.bindPopup(popupContent);
                        }
                    });

                    // Store reference to the layer
                    resourceStorage[resourceId] = {
                        properties: geoJsonData.features.map(f => f.properties),
                        layer: layer
                    };
                    
                    layer.addTo(map);
                    resourceLayers[resourceId] = layer;

                } catch (e) {
                    console.error('Error creating map layer:', e);
                }
            })
            .catch(error => {
                controlLoader.hide();
                console.error(`Error loading ${resourceId}:`, error.message);
                document.getElementById(resourceId).checked = false;
                document.getElementById("resourceControl").classList.remove("disabled");
            });
    } else {
        // Remove layer if unchecked
        if (resourceLayers[resourceId]) {
            map.removeLayer(resourceLayers[resourceId]);
            delete resourceLayers[resourceId];
            delete resourceStorage[resourceId];
        }
    }
}

// Helper function to parse WKB geometry (Point type)
function parseWkbGeometry(wkbHex) {
    try {
        // Simple parser for POINT type WKB (SRID 4326)
        if (wkbHex.length >= 32) {
            // Extract the coordinates part (last 16 characters for X and Y)
            const xHex = wkbHex.substring(wkbHex.length - 32, wkbHex.length - 16);
            const yHex = wkbHex.substring(wkbHex.length - 16);
            
            // Convert from hex to decimal (little-endian)
            const x = hexToDouble(xHex);
            const y = hexToDouble(yHex);
            
            return [x, y]; // Returns [longitude, latitude]
        }
    } catch (e) {
        console.error('Error parsing WKB:', e);
    }
    return null;
}

// Helper function to convert hex to double (for coordinates)
function hexToDouble(hex) {
    const buffer = new ArrayBuffer(8);
    const view = new DataView(buffer);
    for (let i = 0; i < 8; i++) {
        view.setUint8(i, parseInt(hex.substr(i*2, 2), 16));
    }
    return view.getFloat64(0, true); // true for little-endian
}
// Update Field Formations checkbox state
function updateFieldFormationsCheckbox() {
    const fieldStaff = Object.keys(fieldStaffTypes);
    const allChecked = fieldStaff.every(id => document.getElementById(id).checked);
    const someChecked = fieldStaff.some(id => document.getElementById(id).checked);
    
    const ffCheckbox = document.getElementById('field_formations');
    ffCheckbox.checked = allChecked;
    ffCheckbox.indeterminate = someChecked && !allChecked;
}

// Custom icons configuration
const customIcons = {
    firewatcher: L.icon({
        iconUrl: 'http://maps.google.com/mapfiles/kml/shapes/hiker.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    watertank: L.icon({
        iconUrl: 'http://maps.google.com/mapfiles/kml/shapes/water.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    checkpost: L.icon({
        iconUrl: 'http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    waterhydrants: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da088e9a1d-hydrant.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    watchtower: L.icon({
        iconUrl: 'http://maps.google.com/mapfiles/kml/shapes/ranger_station.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    firefighter: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cea68e1-firefighter.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    rescue: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c78b2ac-rescue.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    healthcenters: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da088408c5-hospital.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    volunteers: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0ca8de88-volunteer.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    dfo: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cd2b716-dfo.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    sdfo: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c9997d0-sdfo.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    rfo: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c824e11-rfo.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    block_officer: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0cc9fa19-block_officer.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    }),
    forest_guard: L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da084d225f-forest_guard.png',
        iconSize: [25, 25],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    })
};

// Add command to map
command.addTo(map);

// Toggle collapsible panel
function toggleCollapsible() {
    var content = document.querySelector('.collapsible-content');
    var header = document.querySelector('.collapsible-header');

    if (content.style.maxHeight) {
        content.style.maxHeight = null;
        header.innerHTML = "Select Resources ▼";
    } else {
        content.style.maxHeight = content.scrollHeight + "px";
        header.innerHTML = "Select Resources ▲";
    }
}

      //Distance Measurement Tool
      L.Measure = {
        linearMeasurement: "Distance measurement",
        areaMeasurement: "Area measurement",
        start: "Start",
        meter: "m",
        kilometer: "km",
        squareMeter: "m²",
        acres: "Acres",

      };
      var measure = L.control.measure({}).addTo(map);
      // Create a button control
      L.Control.Button = L.Control.extend({
        includes: L.Evented,
        options: {
          position: 'topleft',
        },
        initialize: function (label, options) {
          L.setOptions(this, options);
          var button = L.DomUtil.create('button', 'leaflet-control-button');
          button.innerHTML = label;

          this._container = button;
          return this;
        },
        onAdd: function (map) {
          L.DomEvent.on(this._container, 'click', this._fireClick, this);
          return this._container;
        },
        _fireClick: function (e) {
          this.fire('click');
        }
      });

      //<----------------------FIRE INCIDENTS SLIDER, CLUSTER and HEATMAP------------------>/////

      // Declare geojsonLayer and sliderControl in the global scope
      let geojsonLayer;
      let sliderControl; // Declare sliderControl here

      // Create a MarkerClusterGroup
      var markers = L.markerClusterGroup();

      // Define the fire icon
      var fireIcon = L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da08733bb5-forest-fire.png', // URL to a fire icon
        iconSize: [30, 30], // Size of the icon [width, height]
        iconAnchor: [15, 30], // Anchor point to properly position the icon
        popupAnchor: [0, -30] // Position of the popup relative to the icon
      });

      // Define the fire icon
      var fireIconC = L.icon({
        iconUrl: 'https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da3e2b84d8-emergency.gif', // URL to a fire icon
        iconSize: [50, 50], // Size of the icon [width, height]
        iconAnchor: [15, 30], // Anchor point to properly position the icon
        popupAnchor: [0, -30] // Position of the popup relative to the icon
      });



      // Fetch current date fire incidents and add them to the MarkerClusterGroup
      fetch('APIs/current_date_incidents.php') // Fetch current date incidents
        .then(response => response.json())
        .then(data => {
          // console.log(data, 'current date fire incidents data');
          // Create the GeoJSON layer for current date incidents
          geojsonLayer = L.geoJSON(data, {
            pointToLayer: function (feature, latlng) {
              return L.marker(latlng, { icon: fireIconC });
            },
            onEachFeature: function (feature, layer) {
              if (feature.properties) {
                // Construct image URL only if an image name exists
                const during = `
                        <b>During Fire:</b><br>
                        ${feature.properties.duringf_image1 ? `<img src="${feature.properties.duringf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.duringf_image2 ? `<img src="${feature.properties.duringf_image2}" style="width: 100px; height: 100px; margin-bottom:2px">` : ''}
                      `;

                const post = `
                        <b>Post Fire:</b><br>
                        ${feature.properties.postf_image1 ? `<img src="${feature.properties.postf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.postf_image2 ? `<img src="${feature.properties.postf_image2}" style="width: 100px; height: 100px; margin-bottom:4px">` : ''}
                      `;

                // Store the original popup content
                const originalContent = `
                          <b>Tehsil:</b> ${feature.properties.tehsil_name}<br>
                          <b>Site:</b> ${feature.properties.fire_site}<br>
                          <b>Date:</b> ${feature.properties.fire_date_time}<br>
                          <b>Beat Name:</b> ${feature.properties.f_beat_name}<br>
                          <b>Incharge Name:</b> ${feature.properties.incharg_name}<br>
                          <b>Forest Guard:</b> ${feature.properties.forest_guard_name}<br>
                          <b>No. of Fire Watchers:</b> ${feature.properties.firewatchers_count}<br>
                          <b>First Information:</b> ${feature.properties.first_information}<br>
                          <b>Kind of Fire:</b> ${feature.properties.kind_of_fire}<br>
                          <b>Coupe Status:</b> ${feature.properties.status_of_coupe}<br>
                          <b>Cause of Fire:</b> ${feature.properties.cause_of_fire}<br>
                          <b>Present Status:</b> ${feature.properties.present_status}<br>
                          ${during}<br>
                          ${post}<br>
                          <input type="number" id="bufferValue" placeholder="Enter Radius(m)" class="buffer-input">
                          <button id="applyBuffer" class="buffer-button">Apply Buffer</button>
                          `;


                // Bind the initial popup content
                layer.bindPopup(originalContent);

                const latitude = parseFloat(feature.properties.latitude);
                const longitude = parseFloat(feature.properties.longitude);

                layer.on('popupopen', function (e) {
                  const button = document.getElementById('applyBuffer');
                  if (button) {
                    button.onclick = function () {
                      const bufferValue = parseFloat(document.getElementById('bufferValue').value);
                      if (!isNaN(bufferValue)) {
                        // Remove existing buffer if any
                        if (layer.bufferCircle) {
                          map.removeLayer(layer.bufferCircle);
                        }

                        // Create new buffer circle
                        layer.bufferCircle = L.circle([latitude, longitude], {
                          radius: bufferValue,
                          color: '#ff0000',
                          fillColor: '#ff0000',
                          fillOpacity: 0.2
                        }).addTo(map);
                        bufferMarker = [latitude, longitude];
                        bufferRadius = bufferValue;
                        // Close the popup
                        layer.closePopup();
                      } else {
                        alert('Please enter a valid buffer radius');
                      }
                    };
                  }
                });

              }
            }
          });



          geojsonLayer.eachLayer(function (layer) {
            incidentsStorage.push(layer); // Push the Leaflet layer object
            markers.addLayer(layer);
          });

          controlLoader.hide();
          // Add the MarkerClusterGroup to the map
          map.addLayer(markers);
        })
        .catch(error => console.error('Error fetching current date fire incidents:', error));
      
        document.getElementById('captureBtn').addEventListener('click', async function () {
    // Check if data has been fetched and stored
    if (!incidentsStorage || incidentsStorage.length === 0) {
        console.log('No Fire Incidents to Report.');
        // Optionally display a message to the user
        return;
    }

    const captureBtn = this;
    const originalText = captureBtn.innerHTML;

    // Show loading state
    captureBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating...';
    captureBtn.disabled = true;

    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });

        // Set default font
        doc.setFont('helvetica', 'normal');

        // Add header function
        const addHeader = () => {
            // Logo
            doc.addImage('https://gis-lab.s3.ap-southeast-1.amazonaws.com/uploads/681da0c64e473-logo_12.png', 'JPEG', 10, 10, 50, 20); // Add logo at the top

            // Title
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(0, 100, 0); // Dark green
            doc.text('FIRE INCIDENT REPORT', 105, 20, { align: 'center' });

            // Date
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            const currentDate = new Date().toLocaleDateString();
            doc.text('Generated', 190, 18, { align: 'right' });
            doc.text(`Date: ${currentDate}`, 190, 22, { align: 'right' });

            // Line separator
            doc.setDrawColor(0, 100, 0); // Dark green
            doc.setLineWidth(1);
            doc.line(10, 35, 200, 35);
        };

        // First page - Incident Details
        addHeader();

        // Incident Details title
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(0, 100, 0); // Dark green
        doc.text('FIRE INCIDENT DETAILS', 105, 45, { align: 'center' });
        doc.setTextColor(0, 0, 0); // Black

        // Prepare table rows using incidentsStorage
        let serialNumber = 0;
        const headers = ["Serial No.", "Fire ID", "Tehsil", "Site", "Date/Time", "Cause", "Latitude", "Longitude"];
        const data = incidentsStorage.map(layer => [ // Iterate over each layer in the GeoJSON layer
            ++serialNumber,
            layer.feature.properties.fire_id,
            layer.feature.properties.tehsil_name,
            layer.feature.properties.fire_site,
            layer.feature.properties.fire_date_time,
            layer.feature.properties.cause_of_fire,
            layer.feature.properties.latitude,
            layer.feature.properties.longitude
        ]);

        doc.autoTable({
            head: [headers],
            body: data,
            margin: { left: 14 },
            startY: 55, // Set the starting Y position for the table
            styles: {
                fontSize: 12,
                cellPadding: 3,
                overflow: 'linebreak'
            },
            headStyles: {
                fillColor: [34, 139, 34],
                textColor: [255, 255, 255],
                fontStyle: 'bold'
            },
            alternateRowStyles: {
                fillColor: [240, 248, 240]
            },
            columnStyles: {
                0: { fontStyle: 'bold' }
            }
        });

        // iMAGE TITLE
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(0, 100, 0); // Dark green
        const captionY = doc.autoTable.previous.finalY + 15; // Position after the table
        if (captionY < doc.internal.pageSize.height - 10) {   // Check if space available
            doc.text('Fire Incident Location', 105, captionY, { align: 'center' });
        }
        doc.setTextColor(0, 0, 0); // Reset text color

        // Add map image if available
        if (globalBlob) {
            console.log('Global Blob is valid, size:', globalBlob.size, 'type:', globalBlob.type);
            try {
                const mapImageUrl = URL.createObjectURL(globalBlob);

                // Add the image to the PDF
                const imageWidth = 190; // Adjust width as needed
                const imageHeight = 150; // Adjust height as needed
                const xPosition = (doc.internal.pageSize.getWidth() - imageWidth) / 2; // Center horizontally
                const yPosition = doc.autoTable.previous.finalY + 10; // Position after the table

                doc.addImage(mapImageUrl, 'PNG', xPosition, yPosition, imageWidth, imageHeight);
                URL.revokeObjectURL(mapImageUrl);

                // Add caption
                doc.setFontSize(8);
                doc.text('Fire Incident Location', 105, yPosition + imageHeight + 5, { align: 'center' });
            } catch (error) {
                console.error('Error adding map image:', error);
            }
        }

        // Define a mapping for resource IDs to titles and properties
        const resourceMapping = {
            firewatcher: {
                title: 'Fire Watcher',
                properties: ['name', 'cnic', 'contact_no', 'address', 'f_subdivision']
            },
            watertank: {
                title: 'Water Tank',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            checkpost: {
                title: 'Check Post',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            waterhydrants: {
                title: 'Water Hydrant',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            watchtower: {
                title: 'Watch Tower',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            firefighter: {
                title: 'Fire Fighter',
                properties: ['name', 'cnic', 'contact_no', 'address', 'f_subdivision']
            },
            rescue: {
                title: 'Rescue 1122 Stations',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            healthcenters: {
                title: 'Health Centers',
                properties: ['name', 'latitude', 'longitude', 'address', 'f_subdivision']
            },
            volunteers: {
                title: 'Volunteers',
                properties: ['name', 'cnic', 'contact_no', 'address', 'f_subdivision']
            }
        };

        // Define a mapping for headers
        const headerMapping = {
            name: 'Name',
            cnic: 'CNIC',
            contact_no: 'Contact No.',
            address: 'Address',
            latitude: 'Latitude',
            longitude: 'Longitude',
            f_subdivision: 'Subdivision'
        };

        // Second page - Resources
        doc.addPage();
        addHeader();

        // Resources title
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(0, 100, 0);
        doc.text('INTERSECTED RESOURCES DETAILS', 105, 45, { align: 'center' });
        doc.setTextColor(0, 0, 0);

        const checkedResources = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
            .map(checkbox => checkbox.id);

        if (checkedResources.length === 0) {
            doc.setFontSize(12);
            doc.text('No resources selected for this report', 14, 55);
        } else {
            let startY = 55;

            for (const resourceId of checkedResources) {
                console.log(`Processing resource: ${resourceId}`); // Debug log

                if (!resourceStorage[resourceId]?.properties?.length) {
                    console.warn(`No data found for resource: ${resourceId}`);
                    continue;
                }

                const resourceData = resourceStorage[resourceId].properties;

                if (startY > 250) {
                    doc.addPage();
                    addHeader();
                    startY = 45;
                }

                // Get resource mapping
                const resourceInfo = resourceMapping[resourceId];
                if (!resourceInfo) {
                    console.warn(`No mapping found for resource: ${resourceId}`);
                    continue;
                }

                // Resource section header
                doc.setFontSize(12);
                doc.setTextColor(0, 100, 0);
                doc.text(`${resourceInfo.title} (${resourceData.length})`, 14, startY);
                doc.setTextColor(0, 0, 0);
                startY += 7;

                // Prepare table data
                const tableData = resourceData.map((item, index) => {
                    const row = {};
                    row['Serial No.'] = index + 1; // Serial number
                    resourceInfo.properties.forEach(prop => {
                        row[prop] = item[prop] !== undefined && item[prop] !== null ? item[prop] : 'N/A';
                    });
                    return row;
                });
                // Prepare headers using the header mapping
                const headers = ['Serial No.'].concat(resourceInfo.properties.map(prop => {
                    return headerMapping[prop] || prop.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                }));

                // Create the table
                doc.autoTable({
                    startY: startY,
                    head: [headers],
                    body: tableData.map(row => Object.values(row)),
                    margin: { left: 14 },
                    styles: { fontSize: 8, cellPadding: 2 },
                    headStyles: {
                        fillColor: [34, 139, 34],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [240, 248, 240]
                    }
                });

                // Update the starting Y position for the next resource
                startY = doc.autoTable.previous.finalY + 10;
            }
        }

        // Footer
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Page ${i} of ${pageCount}`, 105, 287, { align: 'center' });
        }

        // Save the PDF
        const currentDate = new Date();
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed, pad with leading zero
        const day = String(currentDate.getDate()).padStart(2, '0');       // Pad with leading zero

        const fileName = `Fire_Report_${year}${month}${day}.pdf`;
        doc.save(fileName);
        console.log(`Report generated successfully: ${fileName}`);

        // showAlert('The fire incident report has been downloaded', 'Report Generated');

    } catch (error) {
        console.error('Error generating report:', error);
        // showAlert('Failed to generate report: ' + error.message, 'Error');
    } finally {
        // Always reset the button state
        captureBtn.innerHTML = originalText;
        captureBtn.disabled = false;
    }
});



      function resetCapturedMap() {
        globalBlob = null;
      }
      // Fetch all fire incidents for the slider
      fetch('APIs/get_fire_incidents.php') // Fetch all fire incidents
        .then(response => response.json())
        .then(data => {
          //console.log(data, 'all fire incidents data');

          // Initialize the slider **AFTER** geojsonLayer is defined
          sliderControl = L.control.sliderControl({
            layer: L.geoJSON(data, {
              pointToLayer: function (feature, latlng) {
                return L.marker(latlng, { icon: fireIcon }); // Use the fire icon here as well
              },
              onEachFeature: function (feature, layer) {
                if (feature.properties) {
                  const during = `
                        <b>During Fire:</b><br>
                        ${feature.properties.duringf_image1 ? `<img src="${feature.properties.duringf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.duringf_image2 ? `<img src="${feature.properties.duringf_image2}" style="width: 100px; height: 100px; margin-bottom:2px">` : ''}
                      `;

                  const post = `
                        <b>Post Fire:</b><br>
                        ${feature.properties.postf_image1 ? `<img src="${feature.properties.postf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.postf_image2 ? `<img src="${feature.properties.postf_image2}" style="width: 100px; height: 100px; margin-bottom:4px">` : ''}
                      `;

                  // Store the original popup content
                  const originalContent = `
                          <b>Tehsil:</b> ${feature.properties.tehsil_name}<br>
                          <b>Site:</b> ${feature.properties.fire_site}<br>
                          <b>Date:</b> ${feature.properties.fire_date_time}<br>
                          <b>Beat Name:</b> ${feature.properties.f_beat_name}<br>
                          <b>Incharge Name:</b> ${feature.properties.incharg_name}<br>
                          <b>Forest Guard:</b> ${feature.properties.forest_guard_name}<br>
                          <b>No. of Fire Watchers:</b> ${feature.properties.firewatchers_count}<br>
                          <b>First Information:</b> ${feature.properties.first_information}<br>
                          <b>Kind of Fire:</b> ${feature.properties.kind_of_fire}<br>
                          <b>Coupe Status:</b> ${feature.properties.status_of_coupe}<br>
                          <b>Cause of Fire:</b> ${feature.properties.cause_of_fire}<br>
                          <b>Present Status:</b> ${feature.properties.present_status}<br>
                          ${during}<br>
                          ${post}
                        `;

                  // Bind the initial popup content
                  layer.bindPopup(originalContent);
                }
              }
            }),
            position: "topleft",
            range: false,
            showAllOnStart: true,
            alwaysShowDate: true, // Ensure this is enabled
            showAllPopups: false,
            showPopups: false,
            timeAttribute: "fire_date_time", // Ensure the plugin looks for fire_date
            timeStrLength: 10,
          });

          // Add the slider control to the map
          map.addControl(sliderControl);
        })
        .catch(error => console.error('Error fetching all fire incidents:', error));

      // Track the visibility state of controls
      let controlsVisible = false; // Controls are hidden initially

      // Create a toggle button for hiding/showing controls
      var toggleButton = L.control({ position: "topleft" });

      toggleButton.onAdd = function (map) {
        var div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
        div.innerHTML = '<button id="toggle-btn" class="btn_calendar" style="border: 0.5px; cursor: pointer; height: 35px; width:35px"><i class="fa-solid btn_calendar fa-calendar-days fa-2x" ></i></button>';
        return div;
      };

      // Add the toggle button to the map
      map.addControl(toggleButton);

      // Toggle event listener
      document.addEventListener("click", function (event) {
        if (event.target.classList.contains("btn_calendar")) {
          // if (event.target.id === "toggle-btn") {
          if (controlsVisible) {
            // Remove controls and hide the regular GeoJSON layer
            map.removeControl(sliderControl);
            map.removeLayer(geojsonLayer); // Hide the regular GeoJSON layer
            //map.addLayer(markers); // Show the MarkerClusterGroup
          } else {
            if (!map.hasLayer(geojsonLayer)) {
              map.addLayer(geojsonLayer);
            }

            // Add controls and hide the MarkerClusterGroup
            map.addControl(sliderControl);
            sliderControl.startSlider(); // 🔹 Start the slider AFTER adding it
            map.removeLayer(markers); // Hide the MarkerClusterGroup
          }
          controlsVisible = !controlsVisible; // Toggle state
        }
      });



      $(document).ready(function () {
        // Initialize date pickers with proper value handling
        $('#startdate').daterangepicker({
          singleDatePicker: true,
          autoUpdateInput: false,
          locale: {
            format: 'M/D/YYYY', // Matches your API format (no leading zeros)
            cancelLabel: 'Clear'
          }
        }).on('apply.daterangepicker', function (ev, picker) {
          // Format date without leading zeros (3/28/2025 instead of 03/28/2025)
          $(this).val(picker.startDate.format('M/D/YYYY'));
        }).on('cancel.daterangepicker', function () {
          $(this).val('');
        });

        $('#enddate').daterangepicker({
          singleDatePicker: true,
          autoUpdateInput: false,
          locale: {
            format: 'M/D/YYYY',
            cancelLabel: 'Clear'
          }
        }).on('apply.daterangepicker', function (ev, picker) {
          $(this).val(picker.startDate.format('M/D/YYYY'));
        }).on('cancel.daterangepicker', function () {
          $(this).val('');
        });
        $('#b_search').click(function () {
          // Get the selected dates (already in MM/DD/YYYY format)
          const startDate = $('#startdate').val(); // e.g. "03/28/2025"
          const endDate = $('#enddate').val();     // e.g. "03/28/2025"

          if (!startDate || !endDate) {
            alert('Please select both start and end dates.');
            return;
          }

          // No date format conversion needed - use exactly as selected
          // console.log(startDate);
          // console.log(`APIs/get_fire_incidents_by_date.php?start_date=${startDate}&end_date=${endDate}`);
          // Fetch with original date format
          fetch(`APIs/get_fire_incidents_by_date.php?start_date=${startDate}&end_date=${endDate}`)

            .then(response => {
              // console.log('Response status:', response.status); // Should be 200
              if (!response.ok) throw new Error('Network response was not ok');
              return response.json();
            })
            .then(data => {
              // console.log('Received data:', data); // Inspect the actual data
              if (!data || data.length === 0) {
                console.warn('Empty response from server');
                alert('No records found for selected dates');
                return;
              }

              // Process the data (same as before)
              markers.clearLayers();

              const geojsonLayer = L.geoJSON(data, {
                pointToLayer: function (feature, latlng) {
                  return L.marker(latlng, { icon: fireIcon });
                },
                onEachFeature: function (feature, layer) {
                  if (feature.properties) {

                    const during = `
                        <b>During Fire:</b><br>
                        ${feature.properties.duringf_image1 ? `<img src="${feature.properties.duringf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.duringf_image2 ? `<img src="${feature.properties.duringf_image2}" style="width: 100px; height: 100px; margin-bottom:2px">` : ''}
                      `;

                    const post = `
                        <b>Post Fire:</b><br>
                        ${feature.properties.postf_image1 ? `<img src="${feature.properties.postf_image1}" style="width: 100px; height: 100px;">` : ''}
                        ${feature.properties.postf_image2 ? `<img src="${feature.properties.postf_image2}" style="width: 100px; height: 100px; margin-bottom:4px">` : ''}
                      `;

                    // Store the original popup content
                    const originalContent = `
                          <b>Tehsil:</b> ${feature.properties.tehsil_name}<br>
                          <b>Site:</b> ${feature.properties.fire_site}<br>
                          <b>Date:</b> ${feature.properties.fire_date_time}<br>
                          <b>Beat Name:</b> ${feature.properties.f_beat_name}<br>
                          <b>Incharge Name:</b> ${feature.properties.incharg_name}<br>
                          <b>Forest Guard:</b> ${feature.properties.forest_guard_name}<br>
                          <b>No. of Fire Watchers:</b> ${feature.properties.firewatchers_count}<br>
                          <b>First Information:</b> ${feature.properties.first_information}<br>
                          <b>Kind of Fire:</b> ${feature.properties.kind_of_fire}<br>
                          <b>Coupe Status:</b> ${feature.properties.status_of_coupe}<br>
                          <b>Cause of Fire:</b> ${feature.properties.cause_of_fire}<br>
                          <b>Present Status:</b> ${feature.properties.present_status}<br>
                          ${during}<br>
                          ${post}
                        `;
                    // Bind the initial popup content
                    layer.bindPopup(originalContent);

                  }
                }
              });

              geojsonLayer.eachLayer(function (layer) {
                markers.addLayer(layer);
              });

              map.addLayer(markers);
              updateHeatmap(data);
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error loading data. Please check console for details.');
            });
        });
        let heatLayer; // Declare globally to manage toggling later
        let heatmapVisible = false; // Track state

        // Create a toggle button
        var heatmapButton = L.control({ position: "topright" });

        heatmapButton.onAdd = function (map) {
          var div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
          div.innerHTML = '<button id="heatmap-btn" style="background: blue; color: white; padding: 5px; border: none; cursor: pointer;">Heatmap</button>';
          return div;
        };

        map.addControl(heatmapButton);

        // Toggle heatmap on button click
        document.addEventListener("click", function (event) {
          if (event.target.id === "heatmap-btn") {
            if (heatmapVisible) {
              if (heatLayer) {
                map.removeLayer(heatLayer);
              }
            } else {
              if (heatLayer) {
                map.addLayer(heatLayer);
              } else {
                L.popup({
                  className: 'leaflet-alert-popup1' // Optional: Add a custom class for styling
                })
                  .setLatLng(map.getCenter())
                  .setContent("Please enter a range of fire incidents to apply the heatmap.") // Correctly set the content here
                  .openOn(map);
                return;
              }
            }
            heatmapVisible = !heatmapVisible;
          }
        });

        // Function to update the heatmap based on the fetched data
        function updateHeatmap(data) {
          // Extract latitude, longitude, and optional intensity from GeoJSON
          let heatData = data.features.map(feature => {
            let lat = feature.geometry.coordinates[1]; // GeoJSON uses [lon, lat]
            let lon = feature.geometry.coordinates[0];
            return [lat, lon, 1]; // Format: [latitude, longitude, intensity]
          });

          // If heatLayer already exists, remove it before creating a new one
          if (heatLayer) {
            map.removeLayer(heatLayer);
          }

          // Create the heatmap layer with the new data
          heatLayer = L.heatLayer(heatData, {
            radius: 20,  // Controls the spread of heat
            blur: 15,    // Softens the edges
            maxZoom: 15, // Adjust visibility based on zoom level
            gradient: {
              0.2: "blue",
              0.4: "cyan",
              0.6: "yellow",
              0.8: "orange",
              1.0: "red"  // Fire intensity is red
            }
          });

          // Add the heatmap layer to the map if it is currently visible
          if (heatmapVisible) {
            map.addLayer(heatLayer);
          }
        }
      });
    }
    catch (err) {
      //console.log(err, 'catch error');

      window.alert("Plugin Issue");
    };

    //Function for clearing map or remove previously drowned polygons.
    function clearMap() {
      for (i in map._layers) {
        if (map._layers[i]._path != undefined) {
          try {
            map.removeLayer(map._layers[i]);
          }
          catch (e) {
            //console.log("problem with " + e + map._layers[i]);
          };
        };
      };
    };


    // Define currentBoundary in the global scope
    function zoneFunction(forestZone) {
      currentBoundary = { type: 'zone', name: forestZone }; // Update currentBoundary
      clearMap();
      //console.log(forestZone, 'selected zone');
      controlLoader.show();
      fetch(`APIs/get_forest_zone.php?forest_zone=${forestZone}`)
        .then(response => response.json())
        .then(data => {
          //console.log("Fetched Data:", data);
          controlLoader.hide();
          if (data.status === "success" && data.data.length > 0) {
            let geojson = data.data[0].geometry;
            if (!geojson) {
              console.error("Invalid GeoJSON data:", geojson);
              return;
            }
            var geoJsonLayer = L.geoJSON(geojson, {
              style: {
                color: "orange",
                weight: 2,
                opacity: 0.8
              }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
          } else {
            console.error("No geometry found for this zone.");
          }
        })
        .catch(error => {
          console.error("Error fetching zone boundaries:", error);
          controlLoader.hide();
        });
    }

    // Function for Drawing Circle Boundaries
    function circleFunction(circleName) {
      currentBoundary = { type: 'Circle', name: circleName };
      //console.log(circleName, 'selected circle');
      controlLoader.show();
      fetch(`APIs/get_circle.php?forest_circle=${circleName}`)
        .then(response => response.json())
        .then(data => {
          //console.log("Fetched Data:", data);
          controlLoader.hide();
          if (data.status === "success" && data.data.length > 0) {
            let geojson = data.data[0].geometry;
            if (!geojson) {
              console.error("Invalid GeoJSON data:", geojson);
              return;
            }
            var geoJsonLayer = L.geoJSON(geojson, {
              style: {
                color: "blue",
                weight: 2,
                opacity: 0.8
              }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
          } else {
            console.error("No geometry found for this circle.");
          }
        })
        .catch(error => {
          console.error("Error fetching circle boundaries:", error);
          controlLoader.hide();
        });
    }

    // Function for Drawing Division Boundaries
    function divisionFunction(divisionName) {
      currentBoundary = { type: 'Division', name: divisionName };
      //console.log(divisionName, 'selected division');
      controlLoader.show();
      fetch(`APIs/get_division.php?forest_division=${divisionName}`)
        .then(response => response.json())
        .then(data => {
          //console.log("Fetched Data:", data);
          controlLoader.hide();
          if (data.status === "success" && data.data.length > 0) {
            let geojson = data.data[0].geometry;
            if (!geojson) {
              console.error("Invalid GeoJSON data:", geojson);
              return;
            }
            var geoJsonLayer = L.geoJSON(geojson, {
              style: {
                color: "purple",
                weight: 2,
                opacity: 1,
                index: 1000
              }
            }).addTo(map);
            map.fitBounds(geoJsonLayer.getBounds());
          } else {
            console.error("No geometry found for this division.");
          }
        })
        .catch(error => {
          console.error("Error fetching division boundaries:", error);
          controlLoader.hide();
        });
    }


    // Function for Drawing Forest Boundaries
    function forestFunction(forestId) {
      //console.log(forestId, 'selected forest');
      controlLoader.show(); // Show loader

      fetch(`APIs/get_forest.php?unique_id=${forestId}`)
        .then(response => response.json()) // Convert response to JSON
        .then(data => {
          //console.log("Fetched Data:", data);
          controlLoader.hide(); // Hide loader

          // Check if response contains valid data
          if (data.status === "success" && data.data.features && data.data.features.length > 0) {
            let geojson = data.data; // Extract the entire GeoJSON FeatureCollection

            if (!geojson || !geojson.features || geojson.features.length === 0) {
              console.error("Invalid or empty GeoJSON data:", geojson);
              return;
            }

            // Add new GeoJSON layer to the map
            var geoJsonLayer = L.geoJSON(geojson, {
              style: {
                color: "green", // Boundary color
                weight: 2,
                opacity: 0.8,
                fillOpacity: 0.1 // Optional: Add fill color with low opacity
              },
              onEachFeature: function (feature, layer) {
                // Create a popup with the additional properties
                if (feature.properties) {
                  let popupContent = `
                <b>Forest Name:</b> ${feature.properties.forest_name}<br>
                <b>Forest Type:</b> ${feature.properties.forest_type}<br>
                <b>Division:</b> ${feature.properties.f_division}<br>
                <b>Circle:</b> ${feature.properties.f_circle}<br>
                <b>Zone:</b> ${feature.properties.f_zone}<br>
                <b>GPS Area (Acre):</b> ${feature.properties.gps_area_acre}<br>
                <b>Gross Area (Acre):</b> ${feature.properties.gross_area_acre}<br>
                <b>Area (Hec):</b> ${feature.properties.area_hec}<br>
                <b>Legal State:</b> ${feature.properties.legal_state}<br>
                <b>Civil Tehsil:</b> ${feature.properties.civil_tehsil}
              `;
                  layer.bindPopup(popupContent);
                }
              }
            }).addTo(map);

            // Fit the map to the new boundary
            map.fitBounds(geoJsonLayer.getBounds());
          } else {
            console.error("No geometry found for this forest.");
          }
        })
        .catch(error => {
          console.error("Error fetching forest boundaries:", error);
          controlLoader.hide(); // Hide loader in case of error
        });
    }

    // Event listener for forest dropdown change
    document.getElementById('forestSel').addEventListener('change', function () {
      //console.log(this.value, 'Forest');
      forestFunction(this.value); // Call the function with the selected forest ID
    });


  </script>
  <footer>
    &copy; All rights reserved for GIS Lab, Forest Department.
    <?php echo date("Y"); ?>
  </footer>
</body>

</html>